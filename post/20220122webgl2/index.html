<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>WebGL入门 - al4fun&#39;s notes</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="al4fun" /><meta name="description" content="整理自官方API文档及官方入门教程 1 概述 WebGL是一套JavaScript API，可在任何兼容的Web浏览器中渲染高性能的交互式3D和2D" /><meta name="keywords" content="android, web, flutter" />






<meta name="generator" content="Hugo 0.92.0 with theme even" />


<link rel="canonical" href="https://al4fun.gitee.io/post/20220122webgl2/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.cb68f97bc9cece255d217346d970e3c62623408634e500c330a62fadabbbe77c.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="WebGL入门" />
<meta property="og:description" content="整理自官方API文档及官方入门教程 1 概述 WebGL是一套JavaScript API，可在任何兼容的Web浏览器中渲染高性能的交互式3D和2D" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://al4fun.gitee.io/post/20220122webgl2/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-01-22T20:02:10+00:00" />
<meta property="article:modified_time" content="2022-01-22T20:02:10+00:00" />

<meta itemprop="name" content="WebGL入门">
<meta itemprop="description" content="整理自官方API文档及官方入门教程 1 概述 WebGL是一套JavaScript API，可在任何兼容的Web浏览器中渲染高性能的交互式3D和2D"><meta itemprop="datePublished" content="2022-01-22T20:02:10+00:00" />
<meta itemprop="dateModified" content="2022-01-22T20:02:10+00:00" />
<meta itemprop="wordCount" content="10989">
<meta itemprop="keywords" content="WebGL," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="WebGL入门"/>
<meta name="twitter:description" content="整理自官方API文档及官方入门教程 1 概述 WebGL是一套JavaScript API，可在任何兼容的Web浏览器中渲染高性能的交互式3D和2D"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">al4fun&#39;s notes</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">al4fun&#39;s notes</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">WebGL入门</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-01-22 </span>
        <div class="post-category">
            <a href="/categories/3d%E5%9B%BE%E5%BD%A2%E6%8A%80%E6%9C%AF/"> 3D图形技术 </a>
            </div>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#1-概述">1 概述</a></li>
    <li><a href="#2-基本使用">2 基本使用</a></li>
    <li><a href="#3-使用webgl创建2d内容">3 使用WebGL创建2D内容</a>
      <ul>
        <li><a href="#着色器">着色器</a>
          <ul>
            <li><a href="#顶点着色器">顶点着色器</a></li>
            <li><a href="#片段着色器">片段着色器</a></li>
            <li><a href="#创建着色器程序">创建着色器程序</a></li>
          </ul>
        </li>
        <li><a href="#绘制">绘制</a></li>
      </ul>
    </li>
    <li><a href="#4-使用着色器给图形添加颜色">4 使用着色器给图形添加颜色</a></li>
    <li><a href="#5-使正方形旋转">5 使正方形旋转</a></li>
    <li><a href="#6-使用webgl创建3d物体">6 使用WebGL创建3D物体</a></li>
    <li><a href="#7-在webgl中使用纹理贴图texture">7 在WebGL中使用纹理贴图(texture)</a>
      <ul>
        <li><a href="#加载纹理">加载纹理</a></li>
        <li><a href="#非2的幂纹理">非2的幂纹理</a></li>
        <li><a href="#映射纹理到面">映射纹理到面</a></li>
        <li><a href="#纹理坐标">纹理坐标</a></li>
        <li><a href="#完整代码">完整代码</a></li>
      </ul>
    </li>
    <li><a href="#8-webgl中的灯光">8 WebGL中的灯光</a>
      <ul>
        <li><a href="#光照模型">光照模型</a></li>
        <li><a href="#建立顶点法线">建立顶点法线</a></li>
        <li><a href="#完整代码-1">完整代码</a></li>
      </ul>
    </li>
    <li><a href="#9-使用动画纹理贴图了解">9 使用动画纹理贴图(了解)</a>
      <ul>
        <li><a href="#获取视频">获取视频</a></li>
        <li><a href="#用视频帧作为纹理">用视频帧作为纹理</a></li>
        <li><a href="#完整代码-2">完整代码</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <blockquote>
<p>整理自<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebGL_API">官方API文档</a>及<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebGL_API/Tutorial">官方入门教程</a></p>
</blockquote>
<h1 id="1-概述">1 概述</h1>
<p>WebGL是一套JavaScript API，可在任何兼容的Web浏览器中渲染高性能的交互式3D和2D图形，而无需使用插件。</p>
<p>WebGL基于OpenGL ES 2.0。你可以在HTML5的<code>&lt;canvas&gt;</code>元素中调用WebGL。</p>
<blockquote>
<p>目前所有主流浏览器都支持WebGL，即便如此，WebGL是否可用还是取决于硬件设备等其他因素（比如GPU是否支持WebGL）。</p>
</blockquote>
<blockquote>
<p>WebGL 2已经可用，它基于OpenGL ES 3.0。</p>
</blockquote>
<p>WebGL程序包括用 JavaScript 写的控制代码，以及在图形处理单元（GPU）中执行的着色器代码。</p>
<h1 id="2-基本使用">2 基本使用</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;viewport&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;width=device-width, initial-scale=1.0&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>WebGL Demo<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
        <span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
            <span class="kr">const</span> <span class="nx">canvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&#34;#glcanvas&#34;</span><span class="p">);</span>
            <span class="c1">// 获取WebGL上下文(WebGLRenderingContext)
</span><span class="c1"></span>            <span class="kr">const</span> <span class="nx">gl</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s2">&#34;webgl&#34;</span><span class="p">);</span>

            <span class="c1">// 确认WebGL支持性
</span><span class="c1"></span>            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">gl</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">alert</span><span class="p">(</span><span class="s2">&#34;无法初始化WebGL，你的浏览器、操作系统或硬件等可能不支持WebGL。&#34;</span><span class="p">);</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="c1">// 设置clearColor
</span><span class="c1"></span>            <span class="nx">gl</span><span class="p">.</span><span class="nx">clearColor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
            <span class="c1">// 使用clearColor清除颜色缓冲区
</span><span class="c1"></span>            <span class="c1">// 效果就是将画布填充为clearColor
</span><span class="c1"></span>            <span class="nx">gl</span><span class="p">.</span><span class="nx">clear</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">COLOR_BUFFER_BIT</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">body</span> <span class="na">onload</span><span class="o">=</span><span class="s">&#34;main()&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">canvas</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;glcanvas&#34;</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;640&#34;</span> <span class="na">height</span><span class="o">=</span><span class="s">&#34;480&#34;</span><span class="p">&gt;</span>
        你的浏览器似乎不支持或者禁用了HTML5 canvas元素.
    <span class="p">&lt;/</span><span class="nt">canvas</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="3-使用webgl创建2d内容">3 使用WebGL创建2D内容</h1>
<p>下面演示怎么绘制一个简单的正方形。</p>
<h2 id="着色器">着色器</h2>
<h3 id="顶点着色器">顶点着色器</h3>
<p>每次渲染一个形状时，顶点着色器会在形状中的<strong>每个顶点</strong>上运行。它的工作是将输入顶点从<strong>原始坐标系</strong>转换到WebGL使用的<strong>标准坐标系(NDC)</strong>(gl_Position接收的实际是裁剪坐标系坐标，WebGL会自动将裁剪坐标系坐标的x，y，z分量分别除以w，得到NDC，NDC坐标每个轴的坐标范围从-1.0到1.0)。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">vsSource</span> <span class="o">=</span> <span class="sb">`
</span><span class="sb">  attribute vec4 aVertexPosition;
</span><span class="sb">  uniform mat4 uModelViewMatrix;
</span><span class="sb">  uniform mat4 uProjectionMatrix;
</span><span class="sb">
</span><span class="sb">  void main() {
</span><span class="sb">      gl_Position = uProjectionMatrix * uModelViewMatrix * aVertexPosition;
</span><span class="sb">  }
</span><span class="sb">`</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>NDC：</p>
<p><img src="imgs/ndc.png" alt=""></p>
<h3 id="片段着色器">片段着色器</h3>
<p>片段着色器在顶点着色器处理完图形的顶点后，会被要绘制的每个图形的<strong>每个像素</strong>点调用一次。它的职责是确定像素的颜色。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">fsSource</span> <span class="o">=</span> <span class="sb">`
</span><span class="sb">  void main() {
</span><span class="sb">      gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);
</span><span class="sb">  }
</span><span class="sb">`</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="创建着色器程序">创建着色器程序</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// 创建着色器程序
</span><span class="c1"></span><span class="kd">function</span> <span class="nx">initShaderProgram</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">vsSource</span><span class="p">,</span> <span class="nx">fsSource</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">vertexShader</span> <span class="o">=</span> <span class="nx">loadShader</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">VERTEX_SHADER</span><span class="p">,</span> <span class="nx">vsSource</span><span class="p">);</span>
    <span class="kr">const</span> <span class="nx">fragmentShader</span> <span class="o">=</span> <span class="nx">loadShader</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">FRAGMENT_SHADER</span><span class="p">,</span> <span class="nx">fsSource</span><span class="p">);</span>

    <span class="kr">const</span> <span class="nx">shaderProgram</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createProgram</span><span class="p">();</span>
    <span class="nx">gl</span><span class="p">.</span><span class="nx">attachShader</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="nx">vertexShader</span><span class="p">);</span>
    <span class="nx">gl</span><span class="p">.</span><span class="nx">attachShader</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="nx">fragmentShader</span><span class="p">);</span>
    <span class="nx">gl</span><span class="p">.</span><span class="nx">linkProgram</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">);</span>

    <span class="c1">// 创建失败， alert
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">gl</span><span class="p">.</span><span class="nx">getProgramParameter</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">LINK_STATUS</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Unable to initialize the shader program: &#39;</span> <span class="o">+</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getProgramInfoLog</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">));</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">shaderProgram</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// 创建着色器
</span><span class="c1"></span><span class="kd">function</span> <span class="nx">loadShader</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">shader</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createShader</span><span class="p">(</span><span class="nx">type</span><span class="p">);</span>
    <span class="nx">gl</span><span class="p">.</span><span class="nx">shaderSource</span><span class="p">(</span><span class="nx">shader</span><span class="p">,</span> <span class="nx">source</span><span class="p">);</span>
    <span class="nx">gl</span><span class="p">.</span><span class="nx">compileShader</span><span class="p">(</span><span class="nx">shader</span><span class="p">);</span>

    <span class="c1">// See if it compiled successfully
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">gl</span><span class="p">.</span><span class="nx">getShaderParameter</span><span class="p">(</span><span class="nx">shader</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">COMPILE_STATUS</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;An error occurred compiling the shaders: &#39;</span> <span class="o">+</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getShaderInfoLog</span><span class="p">(</span><span class="nx">shader</span><span class="p">));</span>
        <span class="nx">gl</span><span class="p">.</span><span class="nx">deleteShader</span><span class="p">(</span><span class="nx">shader</span><span class="p">);</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">shader</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>在创建着色器程序之后，我们需要获取分配的输入位置。</p>
<p><strong>在上述顶点着色器中，我们有一个属性(attribute)和两个uniforms。</strong></p>
<p><strong>属性从缓冲区接收值。顶点着色器的每次迭代都从分配给该属性的缓冲区接收下一个值。</strong></p>
<p><strong>uniforms类似于JavaScript全局变量。它们在着色器的所有迭代中保持相同的值。</strong></p>
<p>由于位置是特定于单个着色器程序的，因此我们将它们存储在一起以使它们易于传递:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">programInfo</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">program</span><span class="o">:</span> <span class="nx">shaderProgram</span><span class="p">,</span>
    <span class="nx">attribLocations</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">vertexPosition</span><span class="o">:</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getAttribLocation</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="s1">&#39;aVertexPosition&#39;</span><span class="p">),</span>
    <span class="p">},</span>
    <span class="nx">uniformLocations</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">projectionMatrix</span><span class="o">:</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getUniformLocation</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="s1">&#39;uProjectionMatrix&#39;</span><span class="p">),</span>
        <span class="nx">modelViewMatrix</span><span class="o">:</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getUniformLocation</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="s1">&#39;uModelViewMatrix&#39;</span><span class="p">),</span>
    <span class="p">},</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="绘制">绘制</h2>
<p>初始化缓冲区：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">initBuffers</span><span class="p">(</span><span class="nx">gl</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// 创建顶点位置缓冲区
</span><span class="c1"></span>  <span class="kr">const</span> <span class="nx">positionBuffer</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">();</span>
  <span class="c1">// 将缓冲区绑定到gl.ARRAY_BUFFER
</span><span class="c1"></span>  <span class="nx">gl</span><span class="p">.</span><span class="nx">bindBuffer</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">positionBuffer</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">vertices</span> <span class="o">=</span> <span class="p">[</span>
    <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span>
  <span class="p">];</span>
  <span class="c1">// 将数据导入与gl.ARRAY_BUFFER绑定的缓冲区
</span><span class="c1"></span>  <span class="nx">gl</span><span class="p">.</span><span class="nx">bufferData</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span>
                <span class="k">new</span> <span class="nx">Float32Array</span><span class="p">(</span><span class="nx">vertices</span><span class="p">),</span>
                <span class="nx">gl</span><span class="p">.</span><span class="nx">STATIC_DRAW</span><span class="p">);</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">position</span><span class="o">:</span> <span class="nx">positionBuffer</span><span class="p">,</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>绘制：</p>
<blockquote>
<p>你可能会得到这样一段错误报告：“ mat4 is not defined”，意思是说你缺少<code>glmatrix</code>库。该库的js文件<a href="https://mdn.github.io/webgl-examples/tutorial/gl-matrix.js">gl-matrix.js</a>可以从<a href="https://github.com/mdn/webgl-examples/issues/20">这里</a>获得。</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">drawScene</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">programInfo</span><span class="p">,</span> <span class="nx">buffers</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 清除颜色缓冲和深度缓冲
</span><span class="c1"></span>    <span class="nx">gl</span><span class="p">.</span><span class="nx">clearColor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
    <span class="nx">gl</span><span class="p">.</span><span class="nx">clearDepth</span><span class="p">(</span><span class="mf">1.0</span><span class="p">);</span>
    <span class="nx">gl</span><span class="p">.</span><span class="nx">clear</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">COLOR_BUFFER_BIT</span> <span class="o">|</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">DEPTH_BUFFER_BIT</span><span class="p">);</span>

    <span class="nx">gl</span><span class="p">.</span><span class="nx">enable</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">DEPTH_TEST</span><span class="p">);</span> <span class="c1">// Enable depth testing
</span><span class="c1"></span>    <span class="nx">gl</span><span class="p">.</span><span class="nx">depthFunc</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">LEQUAL</span><span class="p">);</span> <span class="c1">// Near things obscure far things
</span><span class="c1"></span>
    <span class="nx">gl</span><span class="p">.</span><span class="nx">useProgram</span><span class="p">(</span><span class="nx">programInfo</span><span class="p">.</span><span class="nx">program</span><span class="p">);</span>

    <span class="c1">// 顶点位置的顶点属性指针
</span><span class="c1"></span>    <span class="p">{</span>
          <span class="c1">// 1.将缓冲区绑定到ARRAY_BUFFER
</span><span class="c1"></span>        <span class="nx">gl</span><span class="p">.</span><span class="nx">bindBuffer</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">buffers</span><span class="p">.</span><span class="nx">position</span><span class="p">);</span>

          <span class="c1">// 2.将与ARRAY_BUFFER绑定的缓冲区分配给vertexPosition
</span><span class="c1"></span>        <span class="kr">const</span> <span class="nx">numComponents</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>  <span class="c1">// 每次从缓冲区中读取三个坐标值(上面的vertices数组中，每三个坐标值代表一个顶点)
</span><span class="c1"></span>        <span class="kr">const</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">FLOAT</span><span class="p">;</span>    <span class="c1">// the data in the buffer is 32bit floats
</span><span class="c1"></span>        <span class="kr">const</span> <span class="nx">normalize</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>  <span class="c1">// don&#39;t normalize
</span><span class="c1"></span>        <span class="kr">const</span> <span class="nx">stride</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>         <span class="c1">// how many bytes to get from one set of values to the next,0代表使用type和numComponents自动计算
</span><span class="c1"></span>        <span class="kr">const</span> <span class="nx">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>         <span class="c1">// how many bytes inside the buffer to start from
</span><span class="c1"></span>        <span class="nx">gl</span><span class="p">.</span><span class="nx">vertexAttribPointer</span><span class="p">(</span>
            <span class="nx">programInfo</span><span class="p">.</span><span class="nx">attribLocations</span><span class="p">.</span><span class="nx">vertexPosition</span><span class="p">,</span>
            <span class="nx">numComponents</span><span class="p">,</span>
            <span class="nx">type</span><span class="p">,</span>
            <span class="nx">normalize</span><span class="p">,</span>
            <span class="nx">stride</span><span class="p">,</span>
            <span class="nx">offset</span><span class="p">);</span>

          <span class="c1">// 3.使分配生效
</span><span class="c1"></span>        <span class="nx">gl</span><span class="p">.</span><span class="nx">enableVertexAttribArray</span><span class="p">(</span>
            <span class="nx">programInfo</span><span class="p">.</span><span class="nx">attribLocations</span><span class="p">.</span><span class="nx">vertexPosition</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// 创建投影矩阵（和Android中创建OpenGL ES投影矩阵使用的参数不同，但原理一样）
</span><span class="c1"></span>    <span class="kr">const</span> <span class="nx">fieldOfView</span> <span class="o">=</span> <span class="mi">45</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="mi">180</span><span class="p">;</span> <span class="c1">// 视角（弧度制）
</span><span class="c1"></span>    <span class="kr">const</span> <span class="nx">aspect</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">clientWidth</span> <span class="o">/</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">clientHeight</span><span class="p">;</span>
    <span class="kr">const</span> <span class="nx">zNear</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>
    <span class="kr">const</span> <span class="nx">zFar</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
    <span class="kr">const</span> <span class="nx">projectionMatrix</span> <span class="o">=</span> <span class="nx">mat4</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
    <span class="nx">mat4</span><span class="p">.</span><span class="nx">perspective</span><span class="p">(</span><span class="nx">projectionMatrix</span><span class="p">,</span>
        <span class="nx">fieldOfView</span><span class="p">,</span>
        <span class="nx">aspect</span><span class="p">,</span>
        <span class="nx">zNear</span><span class="p">,</span>
        <span class="nx">zFar</span><span class="p">);</span>

    <span class="c1">// 按照自己的想法创建modelview矩阵
</span><span class="c1"></span>      <span class="c1">// 由openGL基础知识可知，model矩阵是移动物体，view矩阵是移动相机
</span><span class="c1"></span>      <span class="c1">// 然而相机和物体的位置是相对的，也就是说移动相机和朝相反方向移动物体是等价的
</span><span class="c1"></span>    <span class="kr">const</span> <span class="nx">modelViewMatrix</span> <span class="o">=</span> <span class="nx">mat4</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
    <span class="nx">mat4</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="nx">modelViewMatrix</span><span class="p">,</span>     <span class="c1">// destination matrix
</span><span class="c1"></span>        <span class="nx">modelViewMatrix</span><span class="p">,</span>     <span class="c1">// matrix to translate
</span><span class="c1"></span>        <span class="p">[</span><span class="o">-</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.0</span><span class="p">]);</span>  <span class="c1">// amount to translate
</span><span class="c1"></span>
    <span class="c1">// 将两个矩阵传递到顶点着色器中的uniform变量
</span><span class="c1"></span>    <span class="nx">gl</span><span class="p">.</span><span class="nx">uniformMatrix4fv</span><span class="p">(</span>
        <span class="nx">programInfo</span><span class="p">.</span><span class="nx">uniformLocations</span><span class="p">.</span><span class="nx">projectionMatrix</span><span class="p">,</span>
        <span class="kc">false</span><span class="p">,</span>
        <span class="nx">projectionMatrix</span><span class="p">);</span>
    <span class="nx">gl</span><span class="p">.</span><span class="nx">uniformMatrix4fv</span><span class="p">(</span>
        <span class="nx">programInfo</span><span class="p">.</span><span class="nx">uniformLocations</span><span class="p">.</span><span class="nx">modelViewMatrix</span><span class="p">,</span>
        <span class="kc">false</span><span class="p">,</span>
        <span class="nx">modelViewMatrix</span><span class="p">);</span>

    <span class="c1">// 绘制TRIANGLE_STRIP图元，通过绘制两个邻接的三角形来组成一个正方形
</span><span class="c1"></span>    <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">vertexCount</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
        <span class="nx">gl</span><span class="p">.</span><span class="nx">drawArrays</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TRIANGLE_STRIP</span><span class="p">,</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">vertexCount</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p><img src="imgs/1.png" alt=""></p>
<h1 id="4-使用着色器给图形添加颜色">4 使用着色器给图形添加颜色</h1>
<p>在GL中，物体是由一系列<strong>顶点</strong>组成的，每一个顶点都有位置和颜色信息等<strong>顶点属性</strong>。</p>
<p><strong>顶点属性</strong>包括：顶点位置、顶点颜色、顶点法向量、顶点纹理坐标等等。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!doctype html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;utf-8&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>WebGL Demo<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
    <span class="nt">canvas</span> <span class="p">{</span>
      <span class="k">border</span><span class="p">:</span> <span class="mi">2</span><span class="kt">px</span> <span class="kc">solid</span> <span class="kc">black</span><span class="p">;</span>
      <span class="k">background-color</span><span class="p">:</span> <span class="kc">black</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
  <span class="c">&lt;!-- gl-matrix库 --&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://cdn.bootcdn.net/ajax/libs/gl-matrix/2.8.1/gl-matrix-min.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="c">&lt;!-- 工具函数 --&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="kd">function</span> <span class="nx">initShaderProgram</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">vsSource</span><span class="p">,</span> <span class="nx">fsSource</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">vertexShader</span> <span class="o">=</span> <span class="nx">loadShader</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">VERTEX_SHADER</span><span class="p">,</span> <span class="nx">vsSource</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">fragmentShader</span> <span class="o">=</span> <span class="nx">loadShader</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">FRAGMENT_SHADER</span><span class="p">,</span> <span class="nx">fsSource</span><span class="p">);</span>

      <span class="kr">const</span> <span class="nx">shaderProgram</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createProgram</span><span class="p">();</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">attachShader</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="nx">vertexShader</span><span class="p">);</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">attachShader</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="nx">fragmentShader</span><span class="p">);</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">linkProgram</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">gl</span><span class="p">.</span><span class="nx">getProgramParameter</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">LINK_STATUS</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Unable to initialize the shader program: &#39;</span> <span class="o">+</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getProgramInfoLog</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">));</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="nx">shaderProgram</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">loadShader</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">shader</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createShader</span><span class="p">(</span><span class="nx">type</span><span class="p">);</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">shaderSource</span><span class="p">(</span><span class="nx">shader</span><span class="p">,</span> <span class="nx">source</span><span class="p">);</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">compileShader</span><span class="p">(</span><span class="nx">shader</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">gl</span><span class="p">.</span><span class="nx">getShaderParameter</span><span class="p">(</span><span class="nx">shader</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">COMPILE_STATUS</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;An error occurred compiling the shaders: &#39;</span> <span class="o">+</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getShaderInfoLog</span><span class="p">(</span><span class="nx">shader</span><span class="p">));</span>
        <span class="nx">gl</span><span class="p">.</span><span class="nx">deleteShader</span><span class="p">(</span><span class="nx">shader</span><span class="p">);</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="nx">shader</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">canvas</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;glcanvas&#34;</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;640&#34;</span> <span class="na">height</span><span class="o">=</span><span class="s">&#34;480&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">canvas</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="nx">main</span><span class="p">();</span>

    <span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">canvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#glcanvas&#39;</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">gl</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;webgl&#39;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">gl</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Unable to initialize WebGL. Your browser or machine may not support it.&#39;</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="c1">// 顶点着色器
</span><span class="c1"></span>      <span class="c1">// 通过aVertexColor传入颜色，一个顶点对应一个颜色
</span><span class="c1"></span>      <span class="kr">const</span> <span class="nx">vsSource</span> <span class="o">=</span> <span class="sb">`
</span><span class="sb">                attribute vec4 aVertexPosition;
</span><span class="sb">                attribute vec4 aVertexColor;
</span><span class="sb">                uniform mat4 uModelViewMatrix;
</span><span class="sb">                uniform mat4 uProjectionMatrix;
</span><span class="sb">                varying lowp vec4 vColor;
</span><span class="sb">                void main() {
</span><span class="sb">                    gl_Position = uProjectionMatrix * uModelViewMatrix * aVertexPosition;
</span><span class="sb">                    vColor = aVertexColor;
</span><span class="sb">                }
</span><span class="sb">            `</span><span class="p">;</span>
      <span class="c1">// 片段着色器
</span><span class="c1"></span>      <span class="c1">// 在片段化(即光栅化)的过程中，顶点的颜色数据也会进行插值计算，
</span><span class="c1"></span>      <span class="c1">// 插值计算之前每个顶点对应一个颜色，插值计算之后，每个片段对应一个颜色值，
</span><span class="c1"></span>      <span class="c1">// 通过varying关键字就可以在片段着色器中获得插值后的颜色数据
</span><span class="c1"></span>      <span class="kr">const</span> <span class="nx">fsSource</span> <span class="o">=</span> <span class="sb">`
</span><span class="sb">                varying lowp vec4 vColor;
</span><span class="sb">                void main() {
</span><span class="sb">                    gl_FragColor = vColor;
</span><span class="sb">                }
</span><span class="sb">            `</span><span class="p">;</span>
      <span class="kr">const</span> <span class="nx">shaderProgram</span> <span class="o">=</span> <span class="nx">initShaderProgram</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">vsSource</span><span class="p">,</span> <span class="nx">fsSource</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">programInfo</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">program</span><span class="o">:</span> <span class="nx">shaderProgram</span><span class="p">,</span>
        <span class="nx">attribLocations</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">vertexPosition</span><span class="o">:</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getAttribLocation</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="s1">&#39;aVertexPosition&#39;</span><span class="p">),</span>
          <span class="nx">vertexColor</span><span class="o">:</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getAttribLocation</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="s1">&#39;aVertexColor&#39;</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="nx">uniformLocations</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">projectionMatrix</span><span class="o">:</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getUniformLocation</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="s1">&#39;uProjectionMatrix&#39;</span><span class="p">),</span>
          <span class="nx">modelViewMatrix</span><span class="o">:</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getUniformLocation</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="s1">&#39;uModelViewMatrix&#39;</span><span class="p">),</span>
        <span class="p">},</span>
      <span class="p">};</span>

      <span class="kr">const</span> <span class="nx">buffers</span> <span class="o">=</span> <span class="nx">initBuffers</span><span class="p">(</span><span class="nx">gl</span><span class="p">);</span>

      <span class="nx">drawScene</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">programInfo</span><span class="p">,</span> <span class="nx">buffers</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">drawScene</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">programInfo</span><span class="p">,</span> <span class="nx">buffers</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">clearColor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">clearDepth</span><span class="p">(</span><span class="mf">1.0</span><span class="p">);</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">clear</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">COLOR_BUFFER_BIT</span> <span class="o">|</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">DEPTH_BUFFER_BIT</span><span class="p">);</span>

      <span class="nx">gl</span><span class="p">.</span><span class="nx">enable</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">DEPTH_TEST</span><span class="p">);</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">depthFunc</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">LEQUAL</span><span class="p">);</span>

      <span class="c1">// Tell WebGL how to pull out the positions from the position
</span><span class="c1"></span>      <span class="c1">// buffer into the vertexPosition attribute
</span><span class="c1"></span>      <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">numComponents</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">FLOAT</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">normalize</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">stride</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nx">gl</span><span class="p">.</span><span class="nx">bindBuffer</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">buffers</span><span class="p">.</span><span class="nx">position</span><span class="p">);</span>
        <span class="nx">gl</span><span class="p">.</span><span class="nx">vertexAttribPointer</span><span class="p">(</span>
          <span class="nx">programInfo</span><span class="p">.</span><span class="nx">attribLocations</span><span class="p">.</span><span class="nx">vertexPosition</span><span class="p">,</span>
          <span class="nx">numComponents</span><span class="p">,</span>
          <span class="nx">type</span><span class="p">,</span>
          <span class="nx">normalize</span><span class="p">,</span>
          <span class="nx">stride</span><span class="p">,</span>
          <span class="nx">offset</span><span class="p">);</span>
        <span class="nx">gl</span><span class="p">.</span><span class="nx">enableVertexAttribArray</span><span class="p">(</span>
          <span class="nx">programInfo</span><span class="p">.</span><span class="nx">attribLocations</span><span class="p">.</span><span class="nx">vertexPosition</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="c1">// Tell WebGL how to pull out the colors from the color buffer
</span><span class="c1"></span>      <span class="c1">// into the vertexColor attribute.
</span><span class="c1"></span>      <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">numComponents</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">FLOAT</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">normalize</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">stride</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nx">gl</span><span class="p">.</span><span class="nx">bindBuffer</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">buffers</span><span class="p">.</span><span class="nx">color</span><span class="p">);</span>
        <span class="nx">gl</span><span class="p">.</span><span class="nx">vertexAttribPointer</span><span class="p">(</span>
          <span class="nx">programInfo</span><span class="p">.</span><span class="nx">attribLocations</span><span class="p">.</span><span class="nx">vertexColor</span><span class="p">,</span>
          <span class="nx">numComponents</span><span class="p">,</span>
          <span class="nx">type</span><span class="p">,</span>
          <span class="nx">normalize</span><span class="p">,</span>
          <span class="nx">stride</span><span class="p">,</span>
          <span class="nx">offset</span><span class="p">);</span>
        <span class="nx">gl</span><span class="p">.</span><span class="nx">enableVertexAttribArray</span><span class="p">(</span>
          <span class="nx">programInfo</span><span class="p">.</span><span class="nx">attribLocations</span><span class="p">.</span><span class="nx">vertexColor</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="nx">gl</span><span class="p">.</span><span class="nx">useProgram</span><span class="p">(</span><span class="nx">programInfo</span><span class="p">.</span><span class="nx">program</span><span class="p">);</span>

      <span class="kr">const</span> <span class="nx">fieldOfView</span> <span class="o">=</span> <span class="mi">45</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="mi">180</span><span class="p">;</span>
      <span class="kr">const</span> <span class="nx">aspect</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">clientWidth</span> <span class="o">/</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">clientHeight</span><span class="p">;</span>
      <span class="kr">const</span> <span class="nx">zNear</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>
      <span class="kr">const</span> <span class="nx">zFar</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
      <span class="kr">const</span> <span class="nx">projectionMatrix</span> <span class="o">=</span> <span class="nx">mat4</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
      <span class="nx">mat4</span><span class="p">.</span><span class="nx">perspective</span><span class="p">(</span><span class="nx">projectionMatrix</span><span class="p">,</span>
        <span class="nx">fieldOfView</span><span class="p">,</span>
        <span class="nx">aspect</span><span class="p">,</span>
        <span class="nx">zNear</span><span class="p">,</span>
        <span class="nx">zFar</span><span class="p">);</span>

      <span class="kr">const</span> <span class="nx">modelViewMatrix</span> <span class="o">=</span> <span class="nx">mat4</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
      <span class="nx">mat4</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="nx">modelViewMatrix</span><span class="p">,</span>
        <span class="nx">modelViewMatrix</span><span class="p">,</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.0</span><span class="p">]);</span>

      <span class="nx">gl</span><span class="p">.</span><span class="nx">uniformMatrix4fv</span><span class="p">(</span>
        <span class="nx">programInfo</span><span class="p">.</span><span class="nx">uniformLocations</span><span class="p">.</span><span class="nx">projectionMatrix</span><span class="p">,</span>
        <span class="kc">false</span><span class="p">,</span>
        <span class="nx">projectionMatrix</span><span class="p">);</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">uniformMatrix4fv</span><span class="p">(</span>
        <span class="nx">programInfo</span><span class="p">.</span><span class="nx">uniformLocations</span><span class="p">.</span><span class="nx">modelViewMatrix</span><span class="p">,</span>
        <span class="kc">false</span><span class="p">,</span>
        <span class="nx">modelViewMatrix</span><span class="p">);</span>

      <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">vertexCount</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
        <span class="nx">gl</span><span class="p">.</span><span class="nx">drawArrays</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TRIANGLE_STRIP</span><span class="p">,</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">vertexCount</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">initBuffers</span><span class="p">(</span><span class="nx">gl</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// 顶点位置
</span><span class="c1"></span>      <span class="kr">const</span> <span class="nx">positionBuffer</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">();</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">bindBuffer</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">positionBuffer</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">positions</span> <span class="o">=</span> <span class="p">[</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
      <span class="p">];</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">bufferData</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Float32Array</span><span class="p">(</span><span class="nx">positions</span><span class="p">),</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">STATIC_DRAW</span><span class="p">);</span>

      <span class="c1">// 顶点颜色
</span><span class="c1"></span>      <span class="kr">const</span> <span class="nx">colorBuffer</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">();</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">bindBuffer</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">colorBuffer</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">colors</span> <span class="o">=</span> <span class="p">[</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>    <span class="c1">// white
</span><span class="c1"></span>        <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>    <span class="c1">// red
</span><span class="c1"></span>        <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>    <span class="c1">// green
</span><span class="c1"></span>        <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>    <span class="c1">// blue
</span><span class="c1"></span>      <span class="p">];</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">bufferData</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Float32Array</span><span class="p">(</span><span class="nx">colors</span><span class="p">),</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">STATIC_DRAW</span><span class="p">);</span>

      <span class="k">return</span> <span class="p">{</span>
        <span class="nx">position</span><span class="o">:</span> <span class="nx">positionBuffer</span><span class="p">,</span>
        <span class="nx">color</span><span class="o">:</span> <span class="nx">colorBuffer</span><span class="p">,</span>
      <span class="p">};</span>
    <span class="p">}</span>
  <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="5-使正方形旋转">5 使正方形旋转</h1>
<p>整体思路很简单，通过JS的<code>requestAnimationFrame</code>函数，不断调用<code>drawScene</code>函数。而在<code>drawScene</code>中的创建modelViewMatrix部分，添加旋转相关逻辑：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">modelViewMatrix</span> <span class="o">=</span> <span class="nx">mat4</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
<span class="nx">mat4</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="nx">modelViewMatrix</span><span class="p">,</span>
               <span class="nx">modelViewMatrix</span><span class="p">,</span>
               <span class="p">[</span><span class="o">-</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.0</span><span class="p">]);</span>
<span class="nx">mat4</span><span class="p">.</span><span class="nx">rotate</span><span class="p">(</span><span class="nx">modelViewMatrix</span><span class="p">,</span>  <span class="c1">// destination matrix
</span><span class="c1"></span>            <span class="nx">modelViewMatrix</span><span class="p">,</span>  <span class="c1">// matrix to rotate
</span><span class="c1"></span>            <span class="nx">squareRotation</span><span class="p">,</span>   <span class="c1">// 旋转角度（弧度制）。变量squareRotation中存储了一个随时间而不断变化的角度值
</span><span class="c1"></span>            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]);</span>       <span class="c1">// 旋转轴。[0,0,1]代表绕z轴旋转
</span></code></pre></td></tr></table>
</div>
</div><p>完整代码见：https://github.com/mdn/webgl-examples/tree/gh-pages/tutorial/sample4</p>
<h1 id="6-使用webgl创建3d物体">6 使用WebGL创建3D物体</h1>
<p>现在让我们来绘制一个立方体。</p>
<p><strong>为了提高效率，我们不再通过<code>gl.drawArrays()</code>，直接使用顶点数据来绘制，而是通过<code>gl.drawElements()</code>，使用顶点的索引来绘制——我们会创建包含24个顶点数据的数组，使用数组下标来索引顶点，在绘制时把这些用于索引的下标传递给渲染程序而不是直接把顶点数据传递过去，这样来减少数据传递</strong>。</p>
<blockquote>
<p>也许你会问：每个顶点会被3个面共享，那么使用8个顶点就好了，为什么要使用24个顶点呢？这是因为它们在每个面上需要使用不同的颜色信息。</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="o">&lt;!</span><span class="nx">doctype</span> <span class="nx">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">html</span> <span class="nx">lang</span><span class="o">=</span><span class="s2">&#34;en&#34;</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">charset</span><span class="o">=</span><span class="s2">&#34;utf-8&#34;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;</span><span class="nx">WebGL</span> <span class="nx">Demo</span><span class="o">&lt;</span><span class="err">/title&gt;</span>
  <span class="o">&lt;</span><span class="nx">style</span><span class="o">&gt;</span>
    <span class="nx">canvas</span> <span class="p">{</span>
      <span class="nx">border</span><span class="o">:</span> <span class="mi">2</span><span class="nx">px</span> <span class="nx">solid</span> <span class="nx">black</span><span class="p">;</span>
      <span class="nx">background</span><span class="o">-</span><span class="nx">color</span><span class="o">:</span> <span class="nx">black</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="o">&lt;</span><span class="err">/style&gt;</span>
  <span class="c">&lt;!--</span> <span class="nx">gl</span><span class="o">-</span><span class="nx">matrix库</span> <span class="o">--&gt;</span>
  <span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&#34;https://cdn.bootcdn.net/ajax/libs/gl-matrix/2.8.1/gl-matrix-min.js&#34;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
  <span class="c">&lt;!--</span> <span class="nx">工具函数</span> <span class="o">--&gt;</span>
  <span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
    <span class="kd">function</span> <span class="nx">initShaderProgram</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">vsSource</span><span class="p">,</span> <span class="nx">fsSource</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">vertexShader</span> <span class="o">=</span> <span class="nx">loadShader</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">VERTEX_SHADER</span><span class="p">,</span> <span class="nx">vsSource</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">fragmentShader</span> <span class="o">=</span> <span class="nx">loadShader</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">FRAGMENT_SHADER</span><span class="p">,</span> <span class="nx">fsSource</span><span class="p">);</span>

      <span class="kr">const</span> <span class="nx">shaderProgram</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createProgram</span><span class="p">();</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">attachShader</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="nx">vertexShader</span><span class="p">);</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">attachShader</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="nx">fragmentShader</span><span class="p">);</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">linkProgram</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">gl</span><span class="p">.</span><span class="nx">getProgramParameter</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">LINK_STATUS</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Unable to initialize the shader program: &#39;</span> <span class="o">+</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getProgramInfoLog</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">));</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="nx">shaderProgram</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">loadShader</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">shader</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createShader</span><span class="p">(</span><span class="nx">type</span><span class="p">);</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">shaderSource</span><span class="p">(</span><span class="nx">shader</span><span class="p">,</span> <span class="nx">source</span><span class="p">);</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">compileShader</span><span class="p">(</span><span class="nx">shader</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">gl</span><span class="p">.</span><span class="nx">getShaderParameter</span><span class="p">(</span><span class="nx">shader</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">COMPILE_STATUS</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;An error occurred compiling the shaders: &#39;</span> <span class="o">+</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getShaderInfoLog</span><span class="p">(</span><span class="nx">shader</span><span class="p">));</span>
        <span class="nx">gl</span><span class="p">.</span><span class="nx">deleteShader</span><span class="p">(</span><span class="nx">shader</span><span class="p">);</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="nx">shader</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="o">&lt;</span><span class="err">/script&gt;</span>
<span class="o">&lt;</span><span class="err">/head&gt;</span>

<span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">canvas</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;glcanvas&#34;</span> <span class="nx">width</span><span class="o">=</span><span class="s2">&#34;640&#34;</span> <span class="nx">height</span><span class="o">=</span><span class="s2">&#34;480&#34;</span><span class="o">&gt;&lt;</span><span class="err">/canvas&gt;</span>
  <span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
    <span class="c1">// 立方体旋转的角度，随时间而变
</span><span class="c1"></span>    <span class="kd">var</span> <span class="nx">cubeRotation</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>

    <span class="nx">main</span><span class="p">();</span>

    <span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">canvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#glcanvas&#39;</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">gl</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;webgl&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;experimental-webgl&#39;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">gl</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Unable to initialize WebGL. Your browser or machine may not support it.&#39;</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="kr">const</span> <span class="nx">vsSource</span> <span class="o">=</span> <span class="sb">`
</span><span class="sb">                attribute vec4 aVertexPosition;
</span><span class="sb">                attribute vec4 aVertexColor;
</span><span class="sb">                uniform mat4 uModelViewMatrix;
</span><span class="sb">                uniform mat4 uProjectionMatrix;
</span><span class="sb">                varying lowp vec4 vColor;
</span><span class="sb">                void main() {
</span><span class="sb">                    gl_Position = uProjectionMatrix * uModelViewMatrix * aVertexPosition;
</span><span class="sb">                    vColor = aVertexColor;
</span><span class="sb">                }
</span><span class="sb">            `</span><span class="p">;</span>
      <span class="kr">const</span> <span class="nx">fsSource</span> <span class="o">=</span> <span class="sb">`
</span><span class="sb">                varying lowp vec4 vColor;
</span><span class="sb">                void main() {
</span><span class="sb">                    gl_FragColor = vColor;
</span><span class="sb">                }
</span><span class="sb">            `</span><span class="p">;</span>
      <span class="kr">const</span> <span class="nx">shaderProgram</span> <span class="o">=</span> <span class="nx">initShaderProgram</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">vsSource</span><span class="p">,</span> <span class="nx">fsSource</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">programInfo</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">program</span><span class="o">:</span> <span class="nx">shaderProgram</span><span class="p">,</span>
        <span class="nx">attribLocations</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">vertexPosition</span><span class="o">:</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getAttribLocation</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="s1">&#39;aVertexPosition&#39;</span><span class="p">),</span>
          <span class="nx">vertexColor</span><span class="o">:</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getAttribLocation</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="s1">&#39;aVertexColor&#39;</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="nx">uniformLocations</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">projectionMatrix</span><span class="o">:</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getUniformLocation</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="s1">&#39;uProjectionMatrix&#39;</span><span class="p">),</span>
          <span class="nx">modelViewMatrix</span><span class="o">:</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getUniformLocation</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="s1">&#39;uModelViewMatrix&#39;</span><span class="p">),</span>
        <span class="p">}</span>
      <span class="p">};</span>

      <span class="kr">const</span> <span class="nx">buffers</span> <span class="o">=</span> <span class="nx">initBuffers</span><span class="p">(</span><span class="nx">gl</span><span class="p">);</span>

      <span class="c1">// Draw the scene repeatedly
</span><span class="c1"></span>      <span class="kd">var</span> <span class="nx">then</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="kd">function</span> <span class="nx">render</span><span class="p">(</span><span class="nx">now</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">now</span> <span class="o">*=</span> <span class="mf">0.001</span><span class="p">;</span>  <span class="c1">// convert to seconds
</span><span class="c1"></span>        <span class="kr">const</span> <span class="nx">deltaTime</span> <span class="o">=</span> <span class="nx">now</span> <span class="o">-</span> <span class="nx">then</span><span class="p">;</span>
        <span class="nx">then</span> <span class="o">=</span> <span class="nx">now</span><span class="p">;</span>

        <span class="nx">drawScene</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">programInfo</span><span class="p">,</span> <span class="nx">buffers</span><span class="p">,</span> <span class="nx">deltaTime</span><span class="p">);</span>

        <span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">render</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">render</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">initBuffers</span><span class="p">(</span><span class="nx">gl</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// 顶点位置
</span><span class="c1"></span>      <span class="kr">const</span> <span class="nx">positionBuffer</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">();</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">bindBuffer</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">positionBuffer</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">positions</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1">// Front face
</span><span class="c1"></span>        <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>

        <span class="c1">// Back face
</span><span class="c1"></span>        <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>

        <span class="c1">// Top face
</span><span class="c1"></span>        <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>

        <span class="c1">// Bottom face
</span><span class="c1"></span>        <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>

        <span class="c1">// Right face
</span><span class="c1"></span>        <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>

        <span class="c1">// Left face
</span><span class="c1"></span>        <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
      <span class="p">];</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">bufferData</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Float32Array</span><span class="p">(</span><span class="nx">positions</span><span class="p">),</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">STATIC_DRAW</span><span class="p">);</span>

      <span class="c1">// 顶点颜色
</span><span class="c1"></span>      <span class="c1">// 先定义好立方体每个面的颜色，然后通过for循环构造出每个顶点的颜色
</span><span class="c1"></span>      <span class="kr">const</span> <span class="nx">faceColors</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>    <span class="c1">// Front face: white
</span><span class="c1"></span>        <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>    <span class="c1">// Back face: red
</span><span class="c1"></span>        <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>    <span class="c1">// Top face: green
</span><span class="c1"></span>        <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>    <span class="c1">// Bottom face: blue
</span><span class="c1"></span>        <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>    <span class="c1">// Right face: yellow
</span><span class="c1"></span>        <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>    <span class="c1">// Left face: purple
</span><span class="c1"></span>      <span class="p">];</span>
      <span class="kd">var</span> <span class="nx">colors</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">faceColors</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">j</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">faceColors</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
        <span class="nx">colors</span> <span class="o">=</span> <span class="nx">colors</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">c</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="kr">const</span> <span class="nx">colorBuffer</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">();</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">bindBuffer</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">colorBuffer</span><span class="p">);</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">bufferData</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Float32Array</span><span class="p">(</span><span class="nx">colors</span><span class="p">),</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">STATIC_DRAW</span><span class="p">);</span>

      <span class="c1">// 顶点索引
</span><span class="c1"></span>      <span class="kr">const</span> <span class="nx">indexBuffer</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">();</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">bindBuffer</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ELEMENT_ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">indexBuffer</span><span class="p">);</span>
      <span class="c1">// 每个面由两个三角形组成，indices记录了三角形顶点在positions中的index
</span><span class="c1"></span>      <span class="kr">const</span> <span class="nx">indices</span> <span class="o">=</span> <span class="p">[</span>
        <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>    <span class="c1">// front
</span><span class="c1"></span>        <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span>    <span class="c1">// back
</span><span class="c1"></span>        <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span>   <span class="c1">// top
</span><span class="c1"></span>        <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span>   <span class="c1">// bottom
</span><span class="c1"></span>        <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span>   <span class="c1">// right
</span><span class="c1"></span>        <span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span>   <span class="c1">// left
</span><span class="c1"></span>      <span class="p">];</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">bufferData</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ELEMENT_ARRAY_BUFFER</span><span class="p">,</span>
        <span class="k">new</span> <span class="nx">Uint16Array</span><span class="p">(</span><span class="nx">indices</span><span class="p">),</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">STATIC_DRAW</span><span class="p">);</span>

      <span class="k">return</span> <span class="p">{</span>
        <span class="nx">position</span><span class="o">:</span> <span class="nx">positionBuffer</span><span class="p">,</span>
        <span class="nx">color</span><span class="o">:</span> <span class="nx">colorBuffer</span><span class="p">,</span>
        <span class="nx">indices</span><span class="o">:</span> <span class="nx">indexBuffer</span><span class="p">,</span>
      <span class="p">};</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">drawScene</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">programInfo</span><span class="p">,</span> <span class="nx">buffers</span><span class="p">,</span> <span class="nx">deltaTime</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// 更新旋转角度
</span><span class="c1"></span>      <span class="nx">cubeRotation</span> <span class="o">+=</span> <span class="nx">deltaTime</span><span class="p">;</span>

      <span class="nx">gl</span><span class="p">.</span><span class="nx">clearColor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">clearDepth</span><span class="p">(</span><span class="mf">1.0</span><span class="p">);</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">clear</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">COLOR_BUFFER_BIT</span> <span class="o">|</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">DEPTH_BUFFER_BIT</span><span class="p">);</span>

      <span class="nx">gl</span><span class="p">.</span><span class="nx">enable</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">DEPTH_TEST</span><span class="p">);</span>           <span class="c1">// Enable depth testing
</span><span class="c1"></span>      <span class="nx">gl</span><span class="p">.</span><span class="nx">depthFunc</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">LEQUAL</span><span class="p">);</span>            <span class="c1">// Near things obscure far things
</span><span class="c1"></span>
      <span class="c1">// Tell WebGL how to pull out the positions from the position
</span><span class="c1"></span>      <span class="c1">// buffer into the vertexPosition attribute
</span><span class="c1"></span>      <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">numComponents</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">FLOAT</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">normalize</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">stride</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nx">gl</span><span class="p">.</span><span class="nx">bindBuffer</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">buffers</span><span class="p">.</span><span class="nx">position</span><span class="p">);</span>
        <span class="nx">gl</span><span class="p">.</span><span class="nx">vertexAttribPointer</span><span class="p">(</span>
          <span class="nx">programInfo</span><span class="p">.</span><span class="nx">attribLocations</span><span class="p">.</span><span class="nx">vertexPosition</span><span class="p">,</span>
          <span class="nx">numComponents</span><span class="p">,</span>
          <span class="nx">type</span><span class="p">,</span>
          <span class="nx">normalize</span><span class="p">,</span>
          <span class="nx">stride</span><span class="p">,</span>
          <span class="nx">offset</span><span class="p">);</span>
        <span class="nx">gl</span><span class="p">.</span><span class="nx">enableVertexAttribArray</span><span class="p">(</span>
          <span class="nx">programInfo</span><span class="p">.</span><span class="nx">attribLocations</span><span class="p">.</span><span class="nx">vertexPosition</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="c1">// Tell WebGL how to pull out the colors from the color buffer
</span><span class="c1"></span>      <span class="c1">// into the vertexColor attribute.
</span><span class="c1"></span>      <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">numComponents</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">FLOAT</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">normalize</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">stride</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nx">gl</span><span class="p">.</span><span class="nx">bindBuffer</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">buffers</span><span class="p">.</span><span class="nx">color</span><span class="p">);</span>
        <span class="nx">gl</span><span class="p">.</span><span class="nx">vertexAttribPointer</span><span class="p">(</span>
          <span class="nx">programInfo</span><span class="p">.</span><span class="nx">attribLocations</span><span class="p">.</span><span class="nx">vertexColor</span><span class="p">,</span>
          <span class="nx">numComponents</span><span class="p">,</span>
          <span class="nx">type</span><span class="p">,</span>
          <span class="nx">normalize</span><span class="p">,</span>
          <span class="nx">stride</span><span class="p">,</span>
          <span class="nx">offset</span><span class="p">);</span>
        <span class="nx">gl</span><span class="p">.</span><span class="nx">enableVertexAttribArray</span><span class="p">(</span>
          <span class="nx">programInfo</span><span class="p">.</span><span class="nx">attribLocations</span><span class="p">.</span><span class="nx">vertexColor</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="c1">// Tell WebGL which indices to use to index the vertices
</span><span class="c1"></span>      <span class="nx">gl</span><span class="p">.</span><span class="nx">bindBuffer</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ELEMENT_ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">buffers</span><span class="p">.</span><span class="nx">indices</span><span class="p">);</span>

      <span class="nx">gl</span><span class="p">.</span><span class="nx">useProgram</span><span class="p">(</span><span class="nx">programInfo</span><span class="p">.</span><span class="nx">program</span><span class="p">);</span>

      <span class="c1">// 投影矩阵
</span><span class="c1"></span>      <span class="kr">const</span> <span class="nx">fieldOfView</span> <span class="o">=</span> <span class="mi">45</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="mi">180</span><span class="p">;</span>   <span class="c1">// in radians
</span><span class="c1"></span>      <span class="kr">const</span> <span class="nx">aspect</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">clientWidth</span> <span class="o">/</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">clientHeight</span><span class="p">;</span>
      <span class="kr">const</span> <span class="nx">zNear</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>
      <span class="kr">const</span> <span class="nx">zFar</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
      <span class="kr">const</span> <span class="nx">projectionMatrix</span> <span class="o">=</span> <span class="nx">mat4</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
      <span class="nx">mat4</span><span class="p">.</span><span class="nx">perspective</span><span class="p">(</span><span class="nx">projectionMatrix</span><span class="p">,</span>
        <span class="nx">fieldOfView</span><span class="p">,</span>
        <span class="nx">aspect</span><span class="p">,</span>
        <span class="nx">zNear</span><span class="p">,</span>
        <span class="nx">zFar</span><span class="p">);</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">uniformMatrix4fv</span><span class="p">(</span>
        <span class="nx">programInfo</span><span class="p">.</span><span class="nx">uniformLocations</span><span class="p">.</span><span class="nx">projectionMatrix</span><span class="p">,</span>
        <span class="kc">false</span><span class="p">,</span>
        <span class="nx">projectionMatrix</span><span class="p">);</span>

      <span class="c1">// modelView矩阵
</span><span class="c1"></span>      <span class="kr">const</span> <span class="nx">modelViewMatrix</span> <span class="o">=</span> <span class="nx">mat4</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
      <span class="nx">mat4</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="nx">modelViewMatrix</span><span class="p">,</span>     <span class="c1">// destination matrix
</span><span class="c1"></span>        <span class="nx">modelViewMatrix</span><span class="p">,</span>     <span class="c1">// matrix to translate
</span><span class="c1"></span>        <span class="p">[</span><span class="o">-</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.0</span><span class="p">]);</span>  <span class="c1">// amount to translate
</span><span class="c1"></span>      <span class="nx">mat4</span><span class="p">.</span><span class="nx">rotate</span><span class="p">(</span><span class="nx">modelViewMatrix</span><span class="p">,</span>  <span class="c1">// destination matrix
</span><span class="c1"></span>        <span class="nx">modelViewMatrix</span><span class="p">,</span>  <span class="c1">// matrix to rotate
</span><span class="c1"></span>        <span class="nx">cubeRotation</span><span class="p">,</span>     <span class="c1">// amount to rotate in radians
</span><span class="c1"></span>        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]);</span>       <span class="c1">// axis to rotate around (Z)
</span><span class="c1"></span>      <span class="nx">mat4</span><span class="p">.</span><span class="nx">rotate</span><span class="p">(</span><span class="nx">modelViewMatrix</span><span class="p">,</span>  <span class="c1">// destination matrix
</span><span class="c1"></span>        <span class="nx">modelViewMatrix</span><span class="p">,</span>  <span class="c1">// matrix to rotate
</span><span class="c1"></span>        <span class="nx">cubeRotation</span> <span class="o">*</span> <span class="p">.</span><span class="mi">7</span><span class="p">,</span><span class="c1">// amount to rotate in radians
</span><span class="c1"></span>        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]);</span>       <span class="c1">// axis to rotate around (X)
</span><span class="c1"></span>      <span class="nx">gl</span><span class="p">.</span><span class="nx">uniformMatrix4fv</span><span class="p">(</span>
        <span class="nx">programInfo</span><span class="p">.</span><span class="nx">uniformLocations</span><span class="p">.</span><span class="nx">modelViewMatrix</span><span class="p">,</span>
        <span class="kc">false</span><span class="p">,</span>
        <span class="nx">modelViewMatrix</span><span class="p">);</span>

      <span class="c1">// 绘制
</span><span class="c1"></span>      <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">vertexCount</span> <span class="o">=</span> <span class="mi">36</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">UNSIGNED_SHORT</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="c1">// 绘制的图元类型为TRIANGLES
</span><span class="c1"></span>        <span class="c1">// 通过drawElements使用顶点索引绘制
</span><span class="c1"></span>        <span class="nx">gl</span><span class="p">.</span><span class="nx">drawElements</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TRIANGLES</span><span class="p">,</span> <span class="nx">vertexCount</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">offset</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="o">&lt;</span><span class="err">/script&gt;</span>
<span class="o">&lt;</span><span class="err">/body&gt;</span>

<span class="o">&lt;</span><span class="err">/html&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="7-在webgl中使用纹理贴图texture">7 在WebGL中使用纹理贴图(texture)</h1>
<blockquote>
<p>另参考：<code>OpenGL和OpenGL ES\OpenGL\2.OpenGL入门\OpenGL入门.md</code>。</p>
</blockquote>
<h2 id="加载纹理">加载纹理</h2>
<p>现在我们只使用一张单一的纹理贴到立方体的6个面上，但是同样的方法可以用来加载任意数量的纹理贴图。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">initTextures</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">cubeTexture</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createTexture</span><span class="p">();</span>
  <span class="nx">cubeImage</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">();</span>
  <span class="nx">cubeImage</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">handleTextureLoaded</span><span class="p">(</span><span class="nx">cubeImage</span><span class="p">,</span> <span class="nx">cubeTexture</span><span class="p">);</span> <span class="p">}</span>
  <span class="nx">cubeImage</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s2">&#34;cubetexture.png&#34;</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">handleTextureLoaded</span><span class="p">(</span><span class="nx">image</span><span class="p">,</span> <span class="nx">texture</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// 把纹理对象绑定到gl.TEXTURE_2D
</span><span class="c1"></span>  <span class="nx">gl</span><span class="p">.</span><span class="nx">bindTexture</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="nx">texture</span><span class="p">);</span>
  <span class="c1">// 把图片图形数据写到当前与gl.TEXTURE_2D绑定的纹理对象中
</span><span class="c1"></span>  <span class="nx">gl</span><span class="p">.</span><span class="nx">texImage2D</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">UNSIGNED_BYTE</span><span class="p">,</span> <span class="nx">image</span><span class="p">);</span>

  <span class="c1">// 设置纹理过滤器。过滤器用来控制当图片缩放时像素如何生成如何插值
</span><span class="c1"></span>  <span class="c1">// 我们对图片放大使用的是线性纹理过滤，而对图片缩小使用的是多级渐进纹理过滤
</span><span class="c1"></span>  <span class="c1">// 多级渐进纹理过滤(mipmap)，也称为多级渐远纹理过滤
</span><span class="c1"></span>  <span class="c1">// 详见：OpenGL和OpenGL ES\OpenGL\2.OpenGL入门\OpenGL入门.md
</span><span class="c1"></span>  <span class="nx">gl</span><span class="p">.</span><span class="nx">texParameteri</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_MAG_FILTER</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">LINEAR</span><span class="p">);</span>
  <span class="nx">gl</span><span class="p">.</span><span class="nx">texParameteri</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_MIN_FILTER</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">LINEAR_MIPMAP_NEAREST</span><span class="p">);</span>
  <span class="c1">// 生成多级渐进纹理
</span><span class="c1"></span>  <span class="nx">gl</span><span class="p">.</span><span class="nx">generateMipmap</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">);</span>

  <span class="c1">// 通过给 gl.TEXTURE_2D 绑定值 null 来告诉 WebGL 我们对当前纹理的操作已经结束了
</span><span class="c1"></span>  <span class="nx">gl</span><span class="p">.</span><span class="nx">bindTexture</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>在多数情况下，纹理的宽和高都必须是2的幂（如：1，2，4，8，16等等）。</p>
</blockquote>
<h2 id="非2的幂纹理">非2的幂纹理</h2>
<p>一般来说，宽和高都是2的幂的纹理使用是最理想的。2的幂纹理在渲染内存里的存储更高效，而且对它们的使用限制也更少。纹理的每一边都应该是像1，2，4，8，16，32，64，128，256，512，1024或2048这样的值。</p>
<p>但是，如果你一定要使用非2的幂纹理的话，WebGL也有原生支持，不过这些支持是受限的：这种非2的幂纹理不能用来生成多级渐进纹理，而且不能使用纹理重复。</p>
<p>多级渐进纹理和纹理坐标重复可以通过调用 texParameteri() 来禁用：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// gl.NEAREST is also allowed, instead of gl.LINEAR, as neither mipmap.
</span><span class="c1"></span><span class="nx">gl</span><span class="p">.</span><span class="nx">texParameteri</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_MIN_FILTER</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">LINEAR</span><span class="p">);</span>
<span class="c1">// Prevents s-coordinate wrapping (repeating).
</span><span class="c1"></span><span class="nx">gl</span><span class="p">.</span><span class="nx">texParameteri</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_WRAP_S</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">CLAMP_TO_EDGE</span><span class="p">);</span>
<span class="c1">// Prevents t-coordinate wrapping (repeating).
</span><span class="c1"></span><span class="nx">gl</span><span class="p">.</span><span class="nx">texParameteri</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_WRAP_T</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">CLAMP_TO_EDGE</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>现在，当使用以上参数时，兼容WebGL的设备就会自动变得可以使用任何分辨率的纹理（当然还要考虑像素上限）。如果不使用上面这些参数的话，任何非2的幂纹理使用都会失败然后返回一张纯黑图片。</p>
<h2 id="映射纹理到面">映射纹理到面</h2>
<p>现在，纹理已经加载好了，而且已经可以使用了。但是在使用之前我们还要创建好<strong>纹理坐标到立方体各个面的顶点</strong>的映射关系。</p>
<p>数组变量 <code>textureCoordinates</code> 中定义好了与每个面上的每个顶点一一对应的纹理坐标。</p>
<p>纹理坐标的取值范围是从0.0到1.0（纹理图片左下角为(0,0)，右上角为(1,1)）。</p>
<h2 id="纹理坐标">纹理坐标</h2>
<p>纹理坐标习惯用UVW来表示（因为XYZ已经用过了，所以另选三个字母）。U、V、W坐标的取值范围都是0~1。</p>
<h2 id="完整代码">完整代码</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span><span class="lnt">339
</span><span class="lnt">340
</span><span class="lnt">341
</span><span class="lnt">342
</span><span class="lnt">343
</span><span class="lnt">344
</span><span class="lnt">345
</span><span class="lnt">346
</span><span class="lnt">347
</span><span class="lnt">348
</span><span class="lnt">349
</span><span class="lnt">350
</span><span class="lnt">351
</span><span class="lnt">352
</span><span class="lnt">353
</span><span class="lnt">354
</span><span class="lnt">355
</span><span class="lnt">356
</span><span class="lnt">357
</span><span class="lnt">358
</span><span class="lnt">359
</span><span class="lnt">360
</span><span class="lnt">361
</span><span class="lnt">362
</span><span class="lnt">363
</span><span class="lnt">364
</span><span class="lnt">365
</span><span class="lnt">366
</span><span class="lnt">367
</span><span class="lnt">368
</span><span class="lnt">369
</span><span class="lnt">370
</span><span class="lnt">371
</span><span class="lnt">372
</span><span class="lnt">373
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!doctype html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;utf-8&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>WebGL Demo<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
    <span class="nt">canvas</span> <span class="p">{</span>
      <span class="k">border</span><span class="p">:</span> <span class="mi">2</span><span class="kt">px</span> <span class="kc">solid</span> <span class="kc">black</span><span class="p">;</span>
      <span class="k">background-color</span><span class="p">:</span> <span class="kc">black</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
  <span class="c">&lt;!-- gl-matrix库 --&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://cdn.bootcdn.net/ajax/libs/gl-matrix/2.8.1/gl-matrix-min.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="c">&lt;!-- 工具函数 --&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="kd">function</span> <span class="nx">initShaderProgram</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">vsSource</span><span class="p">,</span> <span class="nx">fsSource</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">vertexShader</span> <span class="o">=</span> <span class="nx">loadShader</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">VERTEX_SHADER</span><span class="p">,</span> <span class="nx">vsSource</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">fragmentShader</span> <span class="o">=</span> <span class="nx">loadShader</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">FRAGMENT_SHADER</span><span class="p">,</span> <span class="nx">fsSource</span><span class="p">);</span>

      <span class="kr">const</span> <span class="nx">shaderProgram</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createProgram</span><span class="p">();</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">attachShader</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="nx">vertexShader</span><span class="p">);</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">attachShader</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="nx">fragmentShader</span><span class="p">);</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">linkProgram</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">gl</span><span class="p">.</span><span class="nx">getProgramParameter</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">LINK_STATUS</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Unable to initialize the shader program: &#39;</span> <span class="o">+</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getProgramInfoLog</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">));</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="nx">shaderProgram</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">loadShader</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">shader</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createShader</span><span class="p">(</span><span class="nx">type</span><span class="p">);</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">shaderSource</span><span class="p">(</span><span class="nx">shader</span><span class="p">,</span> <span class="nx">source</span><span class="p">);</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">compileShader</span><span class="p">(</span><span class="nx">shader</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">gl</span><span class="p">.</span><span class="nx">getShaderParameter</span><span class="p">(</span><span class="nx">shader</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">COMPILE_STATUS</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;An error occurred compiling the shaders: &#39;</span> <span class="o">+</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getShaderInfoLog</span><span class="p">(</span><span class="nx">shader</span><span class="p">));</span>
        <span class="nx">gl</span><span class="p">.</span><span class="nx">deleteShader</span><span class="p">(</span><span class="nx">shader</span><span class="p">);</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="nx">shader</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">loadTexture</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">texture</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createTexture</span><span class="p">();</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">bindTexture</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="nx">texture</span><span class="p">);</span>
      <span class="c1">// 加载纹理图片需要时间
</span><span class="c1"></span>      <span class="c1">// 因此我们先使用了一个蓝色的像素点来作为临时的纹理
</span><span class="c1"></span>      <span class="kr">const</span> <span class="nx">level</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="kr">const</span> <span class="nx">internalFormat</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">;</span>
      <span class="kr">const</span> <span class="nx">width</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="kr">const</span> <span class="nx">height</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="kr">const</span> <span class="nx">border</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="kr">const</span> <span class="nx">srcFormat</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">;</span>
      <span class="kr">const</span> <span class="nx">srcType</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">UNSIGNED_BYTE</span><span class="p">;</span>
      <span class="kr">const</span> <span class="nx">pixel</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Uint8Array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">]);</span>  <span class="c1">// opaque blue
</span><span class="c1"></span>      <span class="nx">gl</span><span class="p">.</span><span class="nx">texImage2D</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="nx">level</span><span class="p">,</span> <span class="nx">internalFormat</span><span class="p">,</span>
        <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">,</span> <span class="nx">border</span><span class="p">,</span> <span class="nx">srcFormat</span><span class="p">,</span> <span class="nx">srcType</span><span class="p">,</span>
        <span class="nx">pixel</span><span class="p">);</span>

      <span class="kr">const</span> <span class="nx">image</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">();</span>
      <span class="nx">image</span><span class="p">.</span><span class="nx">crossOrigin</span> <span class="o">=</span> <span class="s2">&#34;anonymous&#34;</span><span class="p">;</span> <span class="c1">// 支持跨域访问图片
</span><span class="c1"></span>      <span class="nx">image</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">gl</span><span class="p">.</span><span class="nx">bindTexture</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="nx">texture</span><span class="p">);</span>
        <span class="nx">gl</span><span class="p">.</span><span class="nx">texImage2D</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="nx">level</span><span class="p">,</span> <span class="nx">internalFormat</span><span class="p">,</span>
          <span class="nx">srcFormat</span><span class="p">,</span> <span class="nx">srcType</span><span class="p">,</span> <span class="nx">image</span><span class="p">);</span>

        <span class="c1">// 根据图片宽高是否是2的幂，要采取不同的做法
</span><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="nx">isPowerOf2</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">isPowerOf2</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span class="nx">height</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">gl</span><span class="p">.</span><span class="nx">generateMipmap</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">gl</span><span class="p">.</span><span class="nx">texParameteri</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_WRAP_S</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">CLAMP_TO_EDGE</span><span class="p">);</span>
          <span class="nx">gl</span><span class="p">.</span><span class="nx">texParameteri</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_WRAP_T</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">CLAMP_TO_EDGE</span><span class="p">);</span>
          <span class="nx">gl</span><span class="p">.</span><span class="nx">texParameteri</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_MIN_FILTER</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">LINEAR</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">};</span>
      <span class="nx">image</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>

      <span class="k">return</span> <span class="nx">texture</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// 检查value是否是2的幂
</span><span class="c1"></span>    <span class="kd">function</span> <span class="nx">isPowerOf2</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">value</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nx">value</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">canvas</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;glcanvas&#34;</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;640&#34;</span> <span class="na">height</span><span class="o">=</span><span class="s">&#34;480&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">canvas</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="kd">var</span> <span class="nx">cubeRotation</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>

    <span class="nx">main</span><span class="p">();</span>

    <span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">canvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#glcanvas&#39;</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">gl</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;webgl&#39;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">gl</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Unable to initialize WebGL. Your browser or machine may not support it.&#39;</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="kr">const</span> <span class="nx">vsSource</span> <span class="o">=</span> <span class="sb">`
</span><span class="sb">                attribute vec4 aVertexPosition;
</span><span class="sb">                attribute vec2 aTextureCoord; // 当前顶点的纹理坐标
</span><span class="sb">
</span><span class="sb">                uniform mat4 uModelViewMatrix;
</span><span class="sb">                uniform mat4 uProjectionMatrix;
</span><span class="sb">
</span><span class="sb">                varying highp vec2 vTextureCoord;
</span><span class="sb">
</span><span class="sb">                void main() {
</span><span class="sb">                    gl_Position = uProjectionMatrix * uModelViewMatrix * aVertexPosition;
</span><span class="sb">                    vTextureCoord = aTextureCoord;
</span><span class="sb">                }
</span><span class="sb">            `</span><span class="p">;</span>
      <span class="kr">const</span> <span class="nx">fsSource</span> <span class="o">=</span> <span class="sb">`
</span><span class="sb">                varying highp vec2 vTextureCoord; // 当前片段的纹理坐标
</span><span class="sb">
</span><span class="sb">                uniform sampler2D uSampler;
</span><span class="sb">
</span><span class="sb">                void main() {
</span><span class="sb">                    gl_FragColor = texture2D(uSampler, vTextureCoord);
</span><span class="sb">                }
</span><span class="sb">            `</span><span class="p">;</span>
      <span class="kr">const</span> <span class="nx">shaderProgram</span> <span class="o">=</span> <span class="nx">initShaderProgram</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">vsSource</span><span class="p">,</span> <span class="nx">fsSource</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">programInfo</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">program</span><span class="o">:</span> <span class="nx">shaderProgram</span><span class="p">,</span>
        <span class="nx">attribLocations</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">vertexPosition</span><span class="o">:</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getAttribLocation</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="s1">&#39;aVertexPosition&#39;</span><span class="p">),</span>
          <span class="nx">textureCoord</span><span class="o">:</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getAttribLocation</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="s1">&#39;aTextureCoord&#39;</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="nx">uniformLocations</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">projectionMatrix</span><span class="o">:</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getUniformLocation</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="s1">&#39;uProjectionMatrix&#39;</span><span class="p">),</span>
          <span class="nx">modelViewMatrix</span><span class="o">:</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getUniformLocation</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="s1">&#39;uModelViewMatrix&#39;</span><span class="p">),</span>
          <span class="nx">uSampler</span><span class="o">:</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getUniformLocation</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="s1">&#39;uSampler&#39;</span><span class="p">),</span>
        <span class="p">}</span>
      <span class="p">};</span>

      <span class="kr">const</span> <span class="nx">buffers</span> <span class="o">=</span> <span class="nx">initBuffers</span><span class="p">(</span><span class="nx">gl</span><span class="p">);</span>

      <span class="kr">const</span> <span class="nx">texture</span> <span class="o">=</span> <span class="nx">loadTexture</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="s1">&#39;https://raw.githubusercontent.com/mdn/webgl-examples/gh-pages/tutorial/sample6/cubetexture.png&#39;</span><span class="p">);</span>

      <span class="kd">var</span> <span class="nx">then</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="c1">// Draw the scene repeatedly
</span><span class="c1"></span>      <span class="kd">function</span> <span class="nx">render</span><span class="p">(</span><span class="nx">now</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">now</span> <span class="o">*=</span> <span class="mf">0.001</span><span class="p">;</span>  <span class="c1">// convert to seconds
</span><span class="c1"></span>        <span class="kr">const</span> <span class="nx">deltaTime</span> <span class="o">=</span> <span class="nx">now</span> <span class="o">-</span> <span class="nx">then</span><span class="p">;</span>
        <span class="nx">then</span> <span class="o">=</span> <span class="nx">now</span><span class="p">;</span>

        <span class="nx">drawScene</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">programInfo</span><span class="p">,</span> <span class="nx">buffers</span><span class="p">,</span> <span class="nx">texture</span><span class="p">,</span> <span class="nx">deltaTime</span><span class="p">);</span>

        <span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">render</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">render</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">initBuffers</span><span class="p">(</span><span class="nx">gl</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// 顶点位置
</span><span class="c1"></span>      <span class="kr">const</span> <span class="nx">positionBuffer</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">();</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">bindBuffer</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">positionBuffer</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">positions</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1">// Front face
</span><span class="c1"></span>        <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>

        <span class="c1">// Back face
</span><span class="c1"></span>        <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>

        <span class="c1">// Top face
</span><span class="c1"></span>        <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>

        <span class="c1">// Bottom face
</span><span class="c1"></span>        <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>

        <span class="c1">// Right face
</span><span class="c1"></span>        <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>

        <span class="c1">// Left face
</span><span class="c1"></span>        <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
      <span class="p">];</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">bufferData</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Float32Array</span><span class="p">(</span><span class="nx">positions</span><span class="p">),</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">STATIC_DRAW</span><span class="p">);</span>

      <span class="c1">// 顶点的纹理坐标
</span><span class="c1"></span>      <span class="kr">const</span> <span class="nx">textureCoordBuffer</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">();</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">bindBuffer</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">textureCoordBuffer</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">textureCoordinates</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1">// Front
</span><span class="c1"></span>        <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="c1">// Back
</span><span class="c1"></span>        <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="c1">// Top
</span><span class="c1"></span>        <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="c1">// Bottom
</span><span class="c1"></span>        <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="c1">// Right
</span><span class="c1"></span>        <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="c1">// Left
</span><span class="c1"></span>        <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
      <span class="p">];</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">bufferData</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Float32Array</span><span class="p">(</span><span class="nx">textureCoordinates</span><span class="p">),</span>
        <span class="nx">gl</span><span class="p">.</span><span class="nx">STATIC_DRAW</span><span class="p">);</span>

      <span class="c1">// 顶点索引
</span><span class="c1"></span>      <span class="kr">const</span> <span class="nx">indexBuffer</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">();</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">bindBuffer</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ELEMENT_ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">indexBuffer</span><span class="p">);</span>
      <span class="c1">// This array defines each face as two triangles, using the
</span><span class="c1"></span>      <span class="c1">// indices into the vertex array to specify each triangle&#39;s
</span><span class="c1"></span>      <span class="c1">// position.
</span><span class="c1"></span>      <span class="kr">const</span> <span class="nx">indices</span> <span class="o">=</span> <span class="p">[</span>
        <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>    <span class="c1">// front
</span><span class="c1"></span>        <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span>    <span class="c1">// back
</span><span class="c1"></span>        <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span>   <span class="c1">// top
</span><span class="c1"></span>        <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span>   <span class="c1">// bottom
</span><span class="c1"></span>        <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span>   <span class="c1">// right
</span><span class="c1"></span>        <span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span>   <span class="c1">// left
</span><span class="c1"></span>      <span class="p">];</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">bufferData</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ELEMENT_ARRAY_BUFFER</span><span class="p">,</span>
        <span class="k">new</span> <span class="nx">Uint16Array</span><span class="p">(</span><span class="nx">indices</span><span class="p">),</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">STATIC_DRAW</span><span class="p">);</span>

      <span class="k">return</span> <span class="p">{</span>
        <span class="nx">position</span><span class="o">:</span> <span class="nx">positionBuffer</span><span class="p">,</span>
        <span class="nx">textureCoord</span><span class="o">:</span> <span class="nx">textureCoordBuffer</span><span class="p">,</span>
        <span class="nx">indices</span><span class="o">:</span> <span class="nx">indexBuffer</span><span class="p">,</span>
      <span class="p">};</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">drawScene</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">programInfo</span><span class="p">,</span> <span class="nx">buffers</span><span class="p">,</span> <span class="nx">texture</span><span class="p">,</span> <span class="nx">deltaTime</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">cubeRotation</span> <span class="o">+=</span> <span class="nx">deltaTime</span><span class="p">;</span>

      <span class="nx">gl</span><span class="p">.</span><span class="nx">clearColor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">clearDepth</span><span class="p">(</span><span class="mf">1.0</span><span class="p">);</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">clear</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">COLOR_BUFFER_BIT</span> <span class="o">|</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">DEPTH_BUFFER_BIT</span><span class="p">);</span>

      <span class="nx">gl</span><span class="p">.</span><span class="nx">enable</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">DEPTH_TEST</span><span class="p">);</span>           <span class="c1">// Enable depth testing
</span><span class="c1"></span>      <span class="nx">gl</span><span class="p">.</span><span class="nx">depthFunc</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">LEQUAL</span><span class="p">);</span>            <span class="c1">// Near things obscure far things
</span><span class="c1"></span>
      <span class="c1">// Tell WebGL how to pull out the positions from the position
</span><span class="c1"></span>      <span class="c1">// buffer into the vertexPosition attribute
</span><span class="c1"></span>      <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">numComponents</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">FLOAT</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">normalize</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">stride</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nx">gl</span><span class="p">.</span><span class="nx">bindBuffer</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">buffers</span><span class="p">.</span><span class="nx">position</span><span class="p">);</span>
        <span class="nx">gl</span><span class="p">.</span><span class="nx">vertexAttribPointer</span><span class="p">(</span>
          <span class="nx">programInfo</span><span class="p">.</span><span class="nx">attribLocations</span><span class="p">.</span><span class="nx">vertexPosition</span><span class="p">,</span>
          <span class="nx">numComponents</span><span class="p">,</span>
          <span class="nx">type</span><span class="p">,</span>
          <span class="nx">normalize</span><span class="p">,</span>
          <span class="nx">stride</span><span class="p">,</span>
          <span class="nx">offset</span><span class="p">);</span>
        <span class="nx">gl</span><span class="p">.</span><span class="nx">enableVertexAttribArray</span><span class="p">(</span>
          <span class="nx">programInfo</span><span class="p">.</span><span class="nx">attribLocations</span><span class="p">.</span><span class="nx">vertexPosition</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="c1">// Tell WebGL how to pull out the texture coordinates from
</span><span class="c1"></span>      <span class="c1">// the texture coordinate buffer into the textureCoord attribute.
</span><span class="c1"></span>      <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">numComponents</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">FLOAT</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">normalize</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">stride</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nx">gl</span><span class="p">.</span><span class="nx">bindBuffer</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">buffers</span><span class="p">.</span><span class="nx">textureCoord</span><span class="p">);</span>
        <span class="nx">gl</span><span class="p">.</span><span class="nx">vertexAttribPointer</span><span class="p">(</span>
          <span class="nx">programInfo</span><span class="p">.</span><span class="nx">attribLocations</span><span class="p">.</span><span class="nx">textureCoord</span><span class="p">,</span>
          <span class="nx">numComponents</span><span class="p">,</span>
          <span class="nx">type</span><span class="p">,</span>
          <span class="nx">normalize</span><span class="p">,</span>
          <span class="nx">stride</span><span class="p">,</span>
          <span class="nx">offset</span><span class="p">);</span>
        <span class="nx">gl</span><span class="p">.</span><span class="nx">enableVertexAttribArray</span><span class="p">(</span>
          <span class="nx">programInfo</span><span class="p">.</span><span class="nx">attribLocations</span><span class="p">.</span><span class="nx">textureCoord</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="c1">// Tell WebGL which indices to use to index the vertices
</span><span class="c1"></span>      <span class="nx">gl</span><span class="p">.</span><span class="nx">bindBuffer</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ELEMENT_ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">buffers</span><span class="p">.</span><span class="nx">indices</span><span class="p">);</span>

      <span class="nx">gl</span><span class="p">.</span><span class="nx">useProgram</span><span class="p">(</span><span class="nx">programInfo</span><span class="p">.</span><span class="nx">program</span><span class="p">);</span>

      <span class="kr">const</span> <span class="nx">projectionMatrix</span> <span class="o">=</span> <span class="nx">mat4</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
      <span class="kr">const</span> <span class="nx">fieldOfView</span> <span class="o">=</span> <span class="mi">45</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="mi">180</span><span class="p">;</span>   <span class="c1">// in radians
</span><span class="c1"></span>      <span class="kr">const</span> <span class="nx">aspect</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">clientWidth</span> <span class="o">/</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">clientHeight</span><span class="p">;</span>
      <span class="kr">const</span> <span class="nx">zNear</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>
      <span class="kr">const</span> <span class="nx">zFar</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
      <span class="nx">mat4</span><span class="p">.</span><span class="nx">perspective</span><span class="p">(</span><span class="nx">projectionMatrix</span><span class="p">,</span>
        <span class="nx">fieldOfView</span><span class="p">,</span>
        <span class="nx">aspect</span><span class="p">,</span>
        <span class="nx">zNear</span><span class="p">,</span>
        <span class="nx">zFar</span><span class="p">);</span>
      <span class="nx">gl</span><span class="p">.</span><span class="nx">uniformMatrix4fv</span><span class="p">(</span>
        <span class="nx">programInfo</span><span class="p">.</span><span class="nx">uniformLocations</span><span class="p">.</span><span class="nx">projectionMatrix</span><span class="p">,</span>
        <span class="kc">false</span><span class="p">,</span>
        <span class="nx">projectionMatrix</span><span class="p">);</span>

      <span class="kr">const</span> <span class="nx">modelViewMatrix</span> <span class="o">=</span> <span class="nx">mat4</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
      <span class="nx">mat4</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="nx">modelViewMatrix</span><span class="p">,</span>     <span class="c1">// destination matrix
</span><span class="c1"></span>        <span class="nx">modelViewMatrix</span><span class="p">,</span>     <span class="c1">// matrix to translate
</span><span class="c1"></span>        <span class="p">[</span><span class="o">-</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.0</span><span class="p">]);</span>  <span class="c1">// amount to translate
</span><span class="c1"></span>      <span class="nx">mat4</span><span class="p">.</span><span class="nx">rotate</span><span class="p">(</span><span class="nx">modelViewMatrix</span><span class="p">,</span>  <span class="c1">// destination matrix
</span><span class="c1"></span>        <span class="nx">modelViewMatrix</span><span class="p">,</span>  <span class="c1">// matrix to rotate
</span><span class="c1"></span>        <span class="nx">cubeRotation</span><span class="p">,</span>     <span class="c1">// amount to rotate in radians
</span><span class="c1"></span>        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]);</span>       <span class="c1">// axis to rotate around (Z)
</span><span class="c1"></span>      <span class="nx">mat4</span><span class="p">.</span><span class="nx">rotate</span><span class="p">(</span><span class="nx">modelViewMatrix</span><span class="p">,</span>  <span class="c1">// destination matrix
</span><span class="c1"></span>        <span class="nx">modelViewMatrix</span><span class="p">,</span>  <span class="c1">// matrix to rotate
</span><span class="c1"></span>        <span class="nx">cubeRotation</span> <span class="o">*</span> <span class="p">.</span><span class="mi">7</span><span class="p">,</span><span class="c1">// amount to rotate in radians
</span><span class="c1"></span>        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]);</span>       <span class="c1">// axis to rotate around (X)
</span><span class="c1"></span>      <span class="nx">gl</span><span class="p">.</span><span class="nx">uniformMatrix4fv</span><span class="p">(</span>
        <span class="nx">programInfo</span><span class="p">.</span><span class="nx">uniformLocations</span><span class="p">.</span><span class="nx">modelViewMatrix</span><span class="p">,</span>
        <span class="kc">false</span><span class="p">,</span>
        <span class="nx">modelViewMatrix</span><span class="p">);</span>

      <span class="c1">// Tell WebGL we want to affect texture unit 0
</span><span class="c1"></span>      <span class="c1">// GL最多可同时注册32张纹理；gl.TEXTURE0是第一张
</span><span class="c1"></span>      <span class="nx">gl</span><span class="p">.</span><span class="nx">activeTexture</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE0</span><span class="p">);</span>
      <span class="c1">// Bind the texture to texture unit 0
</span><span class="c1"></span>      <span class="nx">gl</span><span class="p">.</span><span class="nx">bindTexture</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="nx">texture</span><span class="p">);</span>
      <span class="c1">// Tell the shader we bound the texture to texture unit 0
</span><span class="c1"></span>      <span class="nx">gl</span><span class="p">.</span><span class="nx">uniform1i</span><span class="p">(</span><span class="nx">programInfo</span><span class="p">.</span><span class="nx">uniformLocations</span><span class="p">.</span><span class="nx">uSampler</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

      <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">vertexCount</span> <span class="o">=</span> <span class="mi">36</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">UNSIGNED_SHORT</span><span class="p">;</span>
        <span class="kr">const</span> <span class="nx">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nx">gl</span><span class="p">.</span><span class="nx">drawElements</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TRIANGLES</span><span class="p">,</span> <span class="nx">vertexCount</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">offset</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="8-webgl中的灯光">8 WebGL中的灯光</h1>
<p>WebGL并没有继承OpenGL中灯光的支持。所以你只能由自己完全的控制灯光。幸运的是，这也并不是很难。</p>
<h2 id="光照模型">光照模型</h2>
<p>光源类型可以概括成如下三种：</p>
<p><strong>环境光</strong> 是一种可以渗透到场景的每一个角落的光。它是非方向光并且会均匀地照射物体的每一个面，无论这个面是朝向哪个方向的。</p>
<p><strong>方向光(平行光)</strong> 是一束从一个固定的方向照射过来的光。这种光的特点可以理解为好像是从一个很遥远的地方照射过来的，然后光线中的每一个光子与其它光子都是平行运动的。举个例子来说，阳光就可以认为是方向光。</p>
<p><strong>点光源光</strong> 是指光线是从一个点发射出来的，是向着四面八方发射的。这种光在我们的现实生活中是最常被用到的。举个例子来说，电灯泡就是向各个方向发射光线的。</p>
<p>以我们的需要来看，我们会简化光照模型，只考虑简单的方向光和环境光，不会考虑任何镜面反射和点光源。</p>
<p>虽然抛开了点光源和镜面反射，但是关于方向光还是有两点需要注意一下：</p>
<ol>
<li>需要在每个顶点的信息中加入面的<strong>朝向法线</strong>。这个法线是一个垂直于这个顶点所在平面的向量。</li>
<li>需要明确方向光的传播方向，可以使用一个<strong>方向向量</strong>来定义。</li>
</ol>
<p>接着，我们会更新顶点着色器，考虑到环境光，再考虑到方向光，计算每一个顶点的颜色。</p>
<h2 id="建立顶点法线">建立顶点法线</h2>
<p>首先我们需要做的是建立一个数组来存放立方体所有顶点的法线。由于立方体是一个很简单的物体，所以很容易实现；显然如果是对复杂物体，则法线的计算方法需要更深入的研究。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">normalBuffer</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">();</span>
<span class="nx">gl</span><span class="p">.</span><span class="nx">bindBuffer</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">normalBuffer</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">vertexNormals</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1">// Front
</span><span class="c1"></span>    <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>

    <span class="c1">// Back
</span><span class="c1"></span>    <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>

    <span class="c1">// Top
</span><span class="c1"></span>    <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>

    <span class="c1">// Bottom
</span><span class="c1"></span>    <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>

    <span class="c1">// Right
</span><span class="c1"></span>    <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>

    <span class="c1">// Left
</span><span class="c1"></span>    <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
<span class="p">];</span>

<span class="nx">gl</span><span class="p">.</span><span class="nx">bufferData</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Float32Array</span><span class="p">(</span><span class="nx">vertexNormals</span><span class="p">),</span>
    <span class="nx">gl</span><span class="p">.</span><span class="nx">STATIC_DRAW</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="完整代码-1">完整代码</h2>
<p>关于光照的计算，参考<code>《WebGL编程指南》摘要.md</code>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span><span class="lnt">339
</span><span class="lnt">340
</span><span class="lnt">341
</span><span class="lnt">342
</span><span class="lnt">343
</span><span class="lnt">344
</span><span class="lnt">345
</span><span class="lnt">346
</span><span class="lnt">347
</span><span class="lnt">348
</span><span class="lnt">349
</span><span class="lnt">350
</span><span class="lnt">351
</span><span class="lnt">352
</span><span class="lnt">353
</span><span class="lnt">354
</span><span class="lnt">355
</span><span class="lnt">356
</span><span class="lnt">357
</span><span class="lnt">358
</span><span class="lnt">359
</span><span class="lnt">360
</span><span class="lnt">361
</span><span class="lnt">362
</span><span class="lnt">363
</span><span class="lnt">364
</span><span class="lnt">365
</span><span class="lnt">366
</span><span class="lnt">367
</span><span class="lnt">368
</span><span class="lnt">369
</span><span class="lnt">370
</span><span class="lnt">371
</span><span class="lnt">372
</span><span class="lnt">373
</span><span class="lnt">374
</span><span class="lnt">375
</span><span class="lnt">376
</span><span class="lnt">377
</span><span class="lnt">378
</span><span class="lnt">379
</span><span class="lnt">380
</span><span class="lnt">381
</span><span class="lnt">382
</span><span class="lnt">383
</span><span class="lnt">384
</span><span class="lnt">385
</span><span class="lnt">386
</span><span class="lnt">387
</span><span class="lnt">388
</span><span class="lnt">389
</span><span class="lnt">390
</span><span class="lnt">391
</span><span class="lnt">392
</span><span class="lnt">393
</span><span class="lnt">394
</span><span class="lnt">395
</span><span class="lnt">396
</span><span class="lnt">397
</span><span class="lnt">398
</span><span class="lnt">399
</span><span class="lnt">400
</span><span class="lnt">401
</span><span class="lnt">402
</span><span class="lnt">403
</span><span class="lnt">404
</span><span class="lnt">405
</span><span class="lnt">406
</span><span class="lnt">407
</span><span class="lnt">408
</span><span class="lnt">409
</span><span class="lnt">410
</span><span class="lnt">411
</span><span class="lnt">412
</span><span class="lnt">413
</span><span class="lnt">414
</span><span class="lnt">415
</span><span class="lnt">416
</span><span class="lnt">417
</span><span class="lnt">418
</span><span class="lnt">419
</span><span class="lnt">420
</span><span class="lnt">421
</span><span class="lnt">422
</span><span class="lnt">423
</span><span class="lnt">424
</span><span class="lnt">425
</span><span class="lnt">426
</span><span class="lnt">427
</span><span class="lnt">428
</span><span class="lnt">429
</span><span class="lnt">430
</span><span class="lnt">431
</span><span class="lnt">432
</span><span class="lnt">433
</span><span class="lnt">434
</span><span class="lnt">435
</span><span class="lnt">436
</span><span class="lnt">437
</span><span class="lnt">438
</span><span class="lnt">439
</span><span class="lnt">440
</span><span class="lnt">441
</span><span class="lnt">442
</span><span class="lnt">443
</span><span class="lnt">444
</span><span class="lnt">445
</span><span class="lnt">446
</span><span class="lnt">447
</span><span class="lnt">448
</span><span class="lnt">449
</span><span class="lnt">450
</span><span class="lnt">451
</span><span class="lnt">452
</span><span class="lnt">453
</span><span class="lnt">454
</span><span class="lnt">455
</span><span class="lnt">456
</span><span class="lnt">457
</span><span class="lnt">458
</span><span class="lnt">459
</span><span class="lnt">460
</span><span class="lnt">461
</span><span class="lnt">462
</span><span class="lnt">463
</span><span class="lnt">464
</span><span class="lnt">465
</span><span class="lnt">466
</span><span class="lnt">467
</span><span class="lnt">468
</span><span class="lnt">469
</span><span class="lnt">470
</span><span class="lnt">471
</span><span class="lnt">472
</span><span class="lnt">473
</span><span class="lnt">474
</span><span class="lnt">475
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!doctype html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;utf-8&#34;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>WebGL Demo<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
        <span class="nt">canvas</span> <span class="p">{</span>
            <span class="k">border</span><span class="p">:</span> <span class="mi">2</span><span class="kt">px</span> <span class="kc">solid</span> <span class="kc">black</span><span class="p">;</span>
            <span class="k">background-color</span><span class="p">:</span> <span class="kc">black</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
    <span class="c">&lt;!-- gl-matrix库 --&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://cdn.bootcdn.net/ajax/libs/gl-matrix/2.8.1/gl-matrix-min.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="c">&lt;!-- 工具函数 --&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
        <span class="kd">function</span> <span class="nx">initShaderProgram</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">vsSource</span><span class="p">,</span> <span class="nx">fsSource</span><span class="p">)</span> <span class="p">{</span>
            <span class="kr">const</span> <span class="nx">vertexShader</span> <span class="o">=</span> <span class="nx">loadShader</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">VERTEX_SHADER</span><span class="p">,</span> <span class="nx">vsSource</span><span class="p">);</span>
            <span class="kr">const</span> <span class="nx">fragmentShader</span> <span class="o">=</span> <span class="nx">loadShader</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">FRAGMENT_SHADER</span><span class="p">,</span> <span class="nx">fsSource</span><span class="p">);</span>

            <span class="kr">const</span> <span class="nx">shaderProgram</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createProgram</span><span class="p">();</span>
            <span class="nx">gl</span><span class="p">.</span><span class="nx">attachShader</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="nx">vertexShader</span><span class="p">);</span>
            <span class="nx">gl</span><span class="p">.</span><span class="nx">attachShader</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="nx">fragmentShader</span><span class="p">);</span>
            <span class="nx">gl</span><span class="p">.</span><span class="nx">linkProgram</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">gl</span><span class="p">.</span><span class="nx">getProgramParameter</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">LINK_STATUS</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Unable to initialize the shader program: &#39;</span> <span class="o">+</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getProgramInfoLog</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">));</span>
                <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="nx">shaderProgram</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">function</span> <span class="nx">loadShader</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
            <span class="kr">const</span> <span class="nx">shader</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createShader</span><span class="p">(</span><span class="nx">type</span><span class="p">);</span>
            <span class="nx">gl</span><span class="p">.</span><span class="nx">shaderSource</span><span class="p">(</span><span class="nx">shader</span><span class="p">,</span> <span class="nx">source</span><span class="p">);</span>
            <span class="nx">gl</span><span class="p">.</span><span class="nx">compileShader</span><span class="p">(</span><span class="nx">shader</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">gl</span><span class="p">.</span><span class="nx">getShaderParameter</span><span class="p">(</span><span class="nx">shader</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">COMPILE_STATUS</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;An error occurred compiling the shaders: &#39;</span> <span class="o">+</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getShaderInfoLog</span><span class="p">(</span><span class="nx">shader</span><span class="p">));</span>
                <span class="nx">gl</span><span class="p">.</span><span class="nx">deleteShader</span><span class="p">(</span><span class="nx">shader</span><span class="p">);</span>
                <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="nx">shader</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">function</span> <span class="nx">loadTexture</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
            <span class="kr">const</span> <span class="nx">texture</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createTexture</span><span class="p">();</span>
            <span class="nx">gl</span><span class="p">.</span><span class="nx">bindTexture</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="nx">texture</span><span class="p">);</span>
            <span class="c1">// 加载纹理图片需要时间
</span><span class="c1"></span>            <span class="c1">// 因此我们先使用了一个蓝色的像素点来作为临时的纹理
</span><span class="c1"></span>            <span class="kr">const</span> <span class="nx">level</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="kr">const</span> <span class="nx">internalFormat</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">;</span>
            <span class="kr">const</span> <span class="nx">width</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="kr">const</span> <span class="nx">height</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="kr">const</span> <span class="nx">border</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="kr">const</span> <span class="nx">srcFormat</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">;</span>
            <span class="kr">const</span> <span class="nx">srcType</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">UNSIGNED_BYTE</span><span class="p">;</span>
            <span class="kr">const</span> <span class="nx">pixel</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Uint8Array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">]);</span>  <span class="c1">// opaque blue
</span><span class="c1"></span>            <span class="nx">gl</span><span class="p">.</span><span class="nx">texImage2D</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="nx">level</span><span class="p">,</span> <span class="nx">internalFormat</span><span class="p">,</span>
                <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">,</span> <span class="nx">border</span><span class="p">,</span> <span class="nx">srcFormat</span><span class="p">,</span> <span class="nx">srcType</span><span class="p">,</span>
                <span class="nx">pixel</span><span class="p">);</span>

            <span class="kr">const</span> <span class="nx">image</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">();</span>
            <span class="nx">image</span><span class="p">.</span><span class="nx">crossOrigin</span> <span class="o">=</span> <span class="s2">&#34;anonymous&#34;</span><span class="p">;</span> <span class="c1">// 支持跨域访问图片
</span><span class="c1"></span>            <span class="nx">image</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="nx">gl</span><span class="p">.</span><span class="nx">bindTexture</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="nx">texture</span><span class="p">);</span>
                <span class="nx">gl</span><span class="p">.</span><span class="nx">texImage2D</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="nx">level</span><span class="p">,</span> <span class="nx">internalFormat</span><span class="p">,</span>
                    <span class="nx">srcFormat</span><span class="p">,</span> <span class="nx">srcType</span><span class="p">,</span> <span class="nx">image</span><span class="p">);</span>

                <span class="c1">// 根据图片宽高是否是2的幂，要采取不同的做法
</span><span class="c1"></span>                <span class="k">if</span> <span class="p">(</span><span class="nx">isPowerOf2</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">isPowerOf2</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span class="nx">height</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">gl</span><span class="p">.</span><span class="nx">generateMipmap</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">gl</span><span class="p">.</span><span class="nx">texParameteri</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_WRAP_S</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">CLAMP_TO_EDGE</span><span class="p">);</span>
                    <span class="nx">gl</span><span class="p">.</span><span class="nx">texParameteri</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_WRAP_T</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">CLAMP_TO_EDGE</span><span class="p">);</span>
                    <span class="nx">gl</span><span class="p">.</span><span class="nx">texParameteri</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_MIN_FILTER</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">LINEAR</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">};</span>
            <span class="nx">image</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>

            <span class="k">return</span> <span class="nx">texture</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// 检测value是否是2的幂
</span><span class="c1"></span>        <span class="kd">function</span> <span class="nx">isPowerOf2</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">(</span><span class="nx">value</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nx">value</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">canvas</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;glcanvas&#34;</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;640&#34;</span> <span class="na">height</span><span class="o">=</span><span class="s">&#34;480&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">canvas</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
        <span class="kd">var</span> <span class="nx">cubeRotation</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>

        <span class="nx">main</span><span class="p">();</span>

        <span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
            <span class="kr">const</span> <span class="nx">canvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#glcanvas&#39;</span><span class="p">);</span>
            <span class="kr">const</span> <span class="nx">gl</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;webgl&#39;</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">gl</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Unable to initialize WebGL. Your browser or machine may not support it.&#39;</span><span class="p">);</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="kr">const</span> <span class="nx">vsSource</span> <span class="o">=</span> <span class="sb">`
</span><span class="sb">                attribute vec4 aVertexPosition;
</span><span class="sb">                attribute vec3 aVertexNormal;
</span><span class="sb">                attribute vec2 aTextureCoord;
</span><span class="sb">
</span><span class="sb">                uniform mat4 uNormalMatrix;
</span><span class="sb">                uniform mat4 uModelViewMatrix;
</span><span class="sb">                uniform mat4 uProjectionMatrix;
</span><span class="sb">
</span><span class="sb">                varying highp vec2 vTextureCoord;
</span><span class="sb">                varying highp vec3 vLighting;
</span><span class="sb">
</span><span class="sb">                void main() {
</span><span class="sb">                    gl_Position = uProjectionMatrix * uModelViewMatrix * aVertexPosition;
</span><span class="sb">                    vTextureCoord = aTextureCoord;
</span><span class="sb">
</span><span class="sb">                    // 环境光
</span><span class="sb">                    highp vec3 ambientLight = vec3(0.3, 0.3, 0.3);
</span><span class="sb">                    // 方向光颜色
</span><span class="sb">                    highp vec3 directionalLightColor = vec3(1, 1, 1);
</span><span class="sb">                    // 方向光的方向向量（normalize函数将向量标准化，即单位化）
</span><span class="sb">                    highp vec3 directionalVector = normalize(vec3(0.85, 0.8, 0.75));
</span><span class="sb">                    // 对顶点法向量进行处理
</span><span class="sb">                    highp vec4 transformedNormal = uNormalMatrix * vec4(aVertexNormal, 1.0);
</span><span class="sb">                    // dot()：点乘。两个矢量的点乘积是一个标量。对比：在glsl中，两个矢量的相乘(*)的结果是仍是一个矢量
</span><span class="sb">                    // 如果结果为负，则取0。因为不可能有小于0的光照
</span><span class="sb">                    highp float directional = max(dot(transformedNormal.xyz, directionalVector), 0.0);
</span><span class="sb">                    // 叠加环境光和方向光
</span><span class="sb">                    vLighting = ambientLight + (directionalLightColor * directional);
</span><span class="sb">                }
</span><span class="sb">            `</span><span class="p">;</span>
            <span class="kr">const</span> <span class="nx">fsSource</span> <span class="o">=</span> <span class="sb">`
</span><span class="sb">                varying highp vec2 vTextureCoord;
</span><span class="sb">                varying highp vec3 vLighting;
</span><span class="sb">
</span><span class="sb">                uniform sampler2D uSampler;
</span><span class="sb">
</span><span class="sb">                void main() {
</span><span class="sb">                    highp vec4 texelColor = texture2D(uSampler, vTextureCoord);
</span><span class="sb">                    gl_FragColor = vec4(texelColor.rgb * vLighting, texelColor.a);
</span><span class="sb">                }
</span><span class="sb">            `</span><span class="p">;</span>
            <span class="kr">const</span> <span class="nx">shaderProgram</span> <span class="o">=</span> <span class="nx">initShaderProgram</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">vsSource</span><span class="p">,</span> <span class="nx">fsSource</span><span class="p">);</span>
            <span class="kr">const</span> <span class="nx">programInfo</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nx">program</span><span class="o">:</span> <span class="nx">shaderProgram</span><span class="p">,</span>
                <span class="nx">attribLocations</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">vertexPosition</span><span class="o">:</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getAttribLocation</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="s1">&#39;aVertexPosition&#39;</span><span class="p">),</span>
                    <span class="nx">vertexNormal</span><span class="o">:</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getAttribLocation</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="s1">&#39;aVertexNormal&#39;</span><span class="p">),</span>
                    <span class="nx">textureCoord</span><span class="o">:</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getAttribLocation</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="s1">&#39;aTextureCoord&#39;</span><span class="p">),</span>
                <span class="p">},</span>
                <span class="nx">uniformLocations</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">projectionMatrix</span><span class="o">:</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getUniformLocation</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="s1">&#39;uProjectionMatrix&#39;</span><span class="p">),</span>
                    <span class="nx">modelViewMatrix</span><span class="o">:</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getUniformLocation</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="s1">&#39;uModelViewMatrix&#39;</span><span class="p">),</span>
                    <span class="nx">normalMatrix</span><span class="o">:</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getUniformLocation</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="s1">&#39;uNormalMatrix&#39;</span><span class="p">),</span>
                    <span class="nx">uSampler</span><span class="o">:</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">getUniformLocation</span><span class="p">(</span><span class="nx">shaderProgram</span><span class="p">,</span> <span class="s1">&#39;uSampler&#39;</span><span class="p">),</span>
                <span class="p">}</span>
            <span class="p">};</span>

            <span class="kr">const</span> <span class="nx">buffers</span> <span class="o">=</span> <span class="nx">initBuffers</span><span class="p">(</span><span class="nx">gl</span><span class="p">);</span>

            <span class="kr">const</span> <span class="nx">texture</span> <span class="o">=</span> <span class="nx">loadTexture</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="s1">&#39;https://raw.githubusercontent.com/mdn/webgl-examples/gh-pages/tutorial/sample6/cubetexture.png&#39;</span><span class="p">);</span>

            <span class="kd">var</span> <span class="nx">then</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="c1">// Draw the scene repeatedly
</span><span class="c1"></span>            <span class="kd">function</span> <span class="nx">render</span><span class="p">(</span><span class="nx">now</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">now</span> <span class="o">*=</span> <span class="mf">0.001</span><span class="p">;</span>  <span class="c1">// convert to seconds
</span><span class="c1"></span>                <span class="kr">const</span> <span class="nx">deltaTime</span> <span class="o">=</span> <span class="nx">now</span> <span class="o">-</span> <span class="nx">then</span><span class="p">;</span>
                <span class="nx">then</span> <span class="o">=</span> <span class="nx">now</span><span class="p">;</span>

                <span class="nx">drawScene</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">programInfo</span><span class="p">,</span> <span class="nx">buffers</span><span class="p">,</span> <span class="nx">texture</span><span class="p">,</span> <span class="nx">deltaTime</span><span class="p">);</span>

                <span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">render</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">render</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="kd">function</span> <span class="nx">initBuffers</span><span class="p">(</span><span class="nx">gl</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// 顶点位置
</span><span class="c1"></span>            <span class="kr">const</span> <span class="nx">positionBuffer</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">();</span>
            <span class="nx">gl</span><span class="p">.</span><span class="nx">bindBuffer</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">positionBuffer</span><span class="p">);</span>
            <span class="kr">const</span> <span class="nx">positions</span> <span class="o">=</span> <span class="p">[</span>
                <span class="c1">// Front face
</span><span class="c1"></span>                <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
                <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
                <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
                <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>

                <span class="c1">// Back face
</span><span class="c1"></span>                <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
                <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
                <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
                <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>

                <span class="c1">// Top face
</span><span class="c1"></span>                <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
                <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
                <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
                <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>

                <span class="c1">// Bottom face
</span><span class="c1"></span>                <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
                <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
                <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
                <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>

                <span class="c1">// Right face
</span><span class="c1"></span>                <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
                <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
                <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
                <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>

                <span class="c1">// Left face
</span><span class="c1"></span>                <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
                <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
                <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
                <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
            <span class="p">];</span>
            <span class="nx">gl</span><span class="p">.</span><span class="nx">bufferData</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Float32Array</span><span class="p">(</span><span class="nx">positions</span><span class="p">),</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">STATIC_DRAW</span><span class="p">);</span>

            <span class="c1">// 顶点法向量
</span><span class="c1"></span>            <span class="c1">// 由于计算需要，各种代表方向的向量都必须是单位向量，也称为归一化向量或标准化向量
</span><span class="c1"></span>            <span class="kr">const</span> <span class="nx">normalBuffer</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">();</span>
            <span class="nx">gl</span><span class="p">.</span><span class="nx">bindBuffer</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">normalBuffer</span><span class="p">);</span>
            <span class="kr">const</span> <span class="nx">vertexNormals</span> <span class="o">=</span> <span class="p">[</span>
                <span class="c1">// Front
</span><span class="c1"></span>                <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
                <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
                <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
                <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>

                <span class="c1">// Back
</span><span class="c1"></span>                <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
                <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
                <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
                <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>

                <span class="c1">// Top
</span><span class="c1"></span>                <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>

                <span class="c1">// Bottom
</span><span class="c1"></span>                <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>

                <span class="c1">// Right
</span><span class="c1"></span>                <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>

                <span class="c1">// Left
</span><span class="c1"></span>                <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
            <span class="p">];</span>
            <span class="nx">gl</span><span class="p">.</span><span class="nx">bufferData</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Float32Array</span><span class="p">(</span><span class="nx">vertexNormals</span><span class="p">),</span>
                <span class="nx">gl</span><span class="p">.</span><span class="nx">STATIC_DRAW</span><span class="p">);</span>

            <span class="c1">// 顶点纹理坐标
</span><span class="c1"></span>            <span class="kr">const</span> <span class="nx">textureCoordBuffer</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">();</span>
            <span class="nx">gl</span><span class="p">.</span><span class="nx">bindBuffer</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">textureCoordBuffer</span><span class="p">);</span>
            <span class="kr">const</span> <span class="nx">textureCoordinates</span> <span class="o">=</span> <span class="p">[</span>
                <span class="c1">// Front
</span><span class="c1"></span>                <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
                <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
                <span class="c1">// Back
</span><span class="c1"></span>                <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
                <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
                <span class="c1">// Top
</span><span class="c1"></span>                <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
                <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
                <span class="c1">// Bottom
</span><span class="c1"></span>                <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
                <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
                <span class="c1">// Right
</span><span class="c1"></span>                <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
                <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
                <span class="c1">// Left
</span><span class="c1"></span>                <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
                <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
            <span class="p">];</span>
            <span class="nx">gl</span><span class="p">.</span><span class="nx">bufferData</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Float32Array</span><span class="p">(</span><span class="nx">textureCoordinates</span><span class="p">),</span>
                <span class="nx">gl</span><span class="p">.</span><span class="nx">STATIC_DRAW</span><span class="p">);</span>

            <span class="c1">// 顶点索引
</span><span class="c1"></span>            <span class="kr">const</span> <span class="nx">indexBuffer</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createBuffer</span><span class="p">();</span>
            <span class="nx">gl</span><span class="p">.</span><span class="nx">bindBuffer</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ELEMENT_ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">indexBuffer</span><span class="p">);</span>
            <span class="c1">// This array defines each face as two triangles, using the
</span><span class="c1"></span>            <span class="c1">// indices into the vertex array to specify each triangle&#39;s
</span><span class="c1"></span>            <span class="c1">// position.
</span><span class="c1"></span>            <span class="kr">const</span> <span class="nx">indices</span> <span class="o">=</span> <span class="p">[</span>
                <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>    <span class="c1">// front
</span><span class="c1"></span>                <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span>    <span class="c1">// back
</span><span class="c1"></span>                <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span>   <span class="c1">// top
</span><span class="c1"></span>                <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span>   <span class="c1">// bottom
</span><span class="c1"></span>                <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span>   <span class="c1">// right
</span><span class="c1"></span>                <span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span>   <span class="c1">// left
</span><span class="c1"></span>            <span class="p">];</span>
            <span class="nx">gl</span><span class="p">.</span><span class="nx">bufferData</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ELEMENT_ARRAY_BUFFER</span><span class="p">,</span>
                <span class="k">new</span> <span class="nx">Uint16Array</span><span class="p">(</span><span class="nx">indices</span><span class="p">),</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">STATIC_DRAW</span><span class="p">);</span>

            <span class="k">return</span> <span class="p">{</span>
                <span class="nx">position</span><span class="o">:</span> <span class="nx">positionBuffer</span><span class="p">,</span>
                <span class="nx">normal</span><span class="o">:</span> <span class="nx">normalBuffer</span><span class="p">,</span>
                <span class="nx">textureCoord</span><span class="o">:</span> <span class="nx">textureCoordBuffer</span><span class="p">,</span>
                <span class="nx">indices</span><span class="o">:</span> <span class="nx">indexBuffer</span><span class="p">,</span>
            <span class="p">};</span>
        <span class="p">}</span>

        <span class="kd">function</span> <span class="nx">drawScene</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">programInfo</span><span class="p">,</span> <span class="nx">buffers</span><span class="p">,</span> <span class="nx">texture</span><span class="p">,</span> <span class="nx">deltaTime</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">cubeRotation</span> <span class="o">+=</span> <span class="nx">deltaTime</span><span class="p">;</span>

            <span class="nx">gl</span><span class="p">.</span><span class="nx">clearColor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
            <span class="nx">gl</span><span class="p">.</span><span class="nx">clearDepth</span><span class="p">(</span><span class="mf">1.0</span><span class="p">);</span>
            <span class="nx">gl</span><span class="p">.</span><span class="nx">clear</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">COLOR_BUFFER_BIT</span> <span class="o">|</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">DEPTH_BUFFER_BIT</span><span class="p">);</span>

            <span class="nx">gl</span><span class="p">.</span><span class="nx">enable</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">DEPTH_TEST</span><span class="p">);</span>           <span class="c1">// Enable depth testing
</span><span class="c1"></span>            <span class="nx">gl</span><span class="p">.</span><span class="nx">depthFunc</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">LEQUAL</span><span class="p">);</span>            <span class="c1">// Near things obscure far things
</span><span class="c1"></span>
            <span class="c1">// Tell WebGL how to pull out the positions from the position
</span><span class="c1"></span>            <span class="c1">// buffer into the vertexPosition attribute
</span><span class="c1"></span>            <span class="p">{</span>
                <span class="kr">const</span> <span class="nx">numComponents</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
                <span class="kr">const</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">FLOAT</span><span class="p">;</span>
                <span class="kr">const</span> <span class="nx">normalize</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                <span class="kr">const</span> <span class="nx">stride</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="kr">const</span> <span class="nx">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="nx">gl</span><span class="p">.</span><span class="nx">bindBuffer</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">buffers</span><span class="p">.</span><span class="nx">position</span><span class="p">);</span>
                <span class="nx">gl</span><span class="p">.</span><span class="nx">vertexAttribPointer</span><span class="p">(</span>
                    <span class="nx">programInfo</span><span class="p">.</span><span class="nx">attribLocations</span><span class="p">.</span><span class="nx">vertexPosition</span><span class="p">,</span>
                    <span class="nx">numComponents</span><span class="p">,</span>
                    <span class="nx">type</span><span class="p">,</span>
                    <span class="nx">normalize</span><span class="p">,</span>
                    <span class="nx">stride</span><span class="p">,</span>
                    <span class="nx">offset</span><span class="p">);</span>
                <span class="nx">gl</span><span class="p">.</span><span class="nx">enableVertexAttribArray</span><span class="p">(</span>
                    <span class="nx">programInfo</span><span class="p">.</span><span class="nx">attribLocations</span><span class="p">.</span><span class="nx">vertexPosition</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="c1">// Tell WebGL how to pull out the texture coordinates from
</span><span class="c1"></span>            <span class="c1">// the texture coordinate buffer into the textureCoord attribute.
</span><span class="c1"></span>            <span class="p">{</span>
                <span class="kr">const</span> <span class="nx">numComponents</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
                <span class="kr">const</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">FLOAT</span><span class="p">;</span>
                <span class="kr">const</span> <span class="nx">normalize</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                <span class="kr">const</span> <span class="nx">stride</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="kr">const</span> <span class="nx">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="nx">gl</span><span class="p">.</span><span class="nx">bindBuffer</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">buffers</span><span class="p">.</span><span class="nx">textureCoord</span><span class="p">);</span>
                <span class="nx">gl</span><span class="p">.</span><span class="nx">vertexAttribPointer</span><span class="p">(</span>
                    <span class="nx">programInfo</span><span class="p">.</span><span class="nx">attribLocations</span><span class="p">.</span><span class="nx">textureCoord</span><span class="p">,</span>
                    <span class="nx">numComponents</span><span class="p">,</span>
                    <span class="nx">type</span><span class="p">,</span>
                    <span class="nx">normalize</span><span class="p">,</span>
                    <span class="nx">stride</span><span class="p">,</span>
                    <span class="nx">offset</span><span class="p">);</span>
                <span class="nx">gl</span><span class="p">.</span><span class="nx">enableVertexAttribArray</span><span class="p">(</span>
                    <span class="nx">programInfo</span><span class="p">.</span><span class="nx">attribLocations</span><span class="p">.</span><span class="nx">textureCoord</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="c1">// Tell WebGL how to pull out the normals from
</span><span class="c1"></span>            <span class="c1">// the normal buffer into the vertexNormal attribute.
</span><span class="c1"></span>            <span class="p">{</span>
                <span class="kr">const</span> <span class="nx">numComponents</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
                <span class="kr">const</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">FLOAT</span><span class="p">;</span>
                <span class="kr">const</span> <span class="nx">normalize</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                <span class="kr">const</span> <span class="nx">stride</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="kr">const</span> <span class="nx">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="nx">gl</span><span class="p">.</span><span class="nx">bindBuffer</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">buffers</span><span class="p">.</span><span class="nx">normal</span><span class="p">);</span>
                <span class="nx">gl</span><span class="p">.</span><span class="nx">vertexAttribPointer</span><span class="p">(</span>
                    <span class="nx">programInfo</span><span class="p">.</span><span class="nx">attribLocations</span><span class="p">.</span><span class="nx">vertexNormal</span><span class="p">,</span>
                    <span class="nx">numComponents</span><span class="p">,</span>
                    <span class="nx">type</span><span class="p">,</span>
                    <span class="nx">normalize</span><span class="p">,</span>
                    <span class="nx">stride</span><span class="p">,</span>
                    <span class="nx">offset</span><span class="p">);</span>
                <span class="nx">gl</span><span class="p">.</span><span class="nx">enableVertexAttribArray</span><span class="p">(</span>
                    <span class="nx">programInfo</span><span class="p">.</span><span class="nx">attribLocations</span><span class="p">.</span><span class="nx">vertexNormal</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="c1">// Tell WebGL which indices to use to index the vertices
</span><span class="c1"></span>            <span class="nx">gl</span><span class="p">.</span><span class="nx">bindBuffer</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">ELEMENT_ARRAY_BUFFER</span><span class="p">,</span> <span class="nx">buffers</span><span class="p">.</span><span class="nx">indices</span><span class="p">);</span>

            <span class="nx">gl</span><span class="p">.</span><span class="nx">useProgram</span><span class="p">(</span><span class="nx">programInfo</span><span class="p">.</span><span class="nx">program</span><span class="p">);</span>

            <span class="c1">// 投影矩阵
</span><span class="c1"></span>            <span class="kr">const</span> <span class="nx">fieldOfView</span> <span class="o">=</span> <span class="mi">45</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="mi">180</span><span class="p">;</span>   <span class="c1">// in radians
</span><span class="c1"></span>            <span class="kr">const</span> <span class="nx">aspect</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">clientWidth</span> <span class="o">/</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">clientHeight</span><span class="p">;</span>
            <span class="kr">const</span> <span class="nx">zNear</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>
            <span class="kr">const</span> <span class="nx">zFar</span> <span class="o">=</span> <span class="mf">100.0</span><span class="p">;</span>
            <span class="kr">const</span> <span class="nx">projectionMatrix</span> <span class="o">=</span> <span class="nx">mat4</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
            <span class="nx">mat4</span><span class="p">.</span><span class="nx">perspective</span><span class="p">(</span><span class="nx">projectionMatrix</span><span class="p">,</span>
                <span class="nx">fieldOfView</span><span class="p">,</span>
                <span class="nx">aspect</span><span class="p">,</span>
                <span class="nx">zNear</span><span class="p">,</span>
                <span class="nx">zFar</span><span class="p">);</span>

            <span class="c1">// modelViewMatrix
</span><span class="c1"></span>            <span class="kr">const</span> <span class="nx">modelViewMatrix</span> <span class="o">=</span> <span class="nx">mat4</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
            <span class="nx">mat4</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="nx">modelViewMatrix</span><span class="p">,</span>     <span class="c1">// destination matrix
</span><span class="c1"></span>                <span class="nx">modelViewMatrix</span><span class="p">,</span>     <span class="c1">// matrix to translate
</span><span class="c1"></span>                <span class="p">[</span><span class="o">-</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.0</span><span class="p">]);</span>  <span class="c1">// amount to translate
</span><span class="c1"></span>            <span class="nx">mat4</span><span class="p">.</span><span class="nx">rotate</span><span class="p">(</span><span class="nx">modelViewMatrix</span><span class="p">,</span>  <span class="c1">// destination matrix
</span><span class="c1"></span>                <span class="nx">modelViewMatrix</span><span class="p">,</span>  <span class="c1">// matrix to rotate
</span><span class="c1"></span>                <span class="nx">cubeRotation</span><span class="p">,</span>     <span class="c1">// amount to rotate in radians
</span><span class="c1"></span>                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]);</span>       <span class="c1">// axis to rotate around (Z)
</span><span class="c1"></span>            <span class="nx">mat4</span><span class="p">.</span><span class="nx">rotate</span><span class="p">(</span><span class="nx">modelViewMatrix</span><span class="p">,</span>  <span class="c1">// destination matrix
</span><span class="c1"></span>                <span class="nx">modelViewMatrix</span><span class="p">,</span>  <span class="c1">// matrix to rotate
</span><span class="c1"></span>                <span class="nx">cubeRotation</span> <span class="o">*</span> <span class="p">.</span><span class="mi">7</span><span class="p">,</span><span class="c1">// amount to rotate in radians
</span><span class="c1"></span>                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]);</span>       <span class="c1">// axis to rotate around (X)
</span><span class="c1"></span>
            <span class="c1">// normalMatrix
</span><span class="c1"></span>            <span class="c1">// which is used to transform the normals when dealing with the current orientation of the cube in relation to the light source
</span><span class="c1"></span>            <span class="c1">// 因为目标物体经过了modelViewMatrix处理，所以顶点的法线也要做相应的处理，对顶点法线进行处理使用的就是normalMatrix
</span><span class="c1"></span>            <span class="kr">const</span> <span class="nx">normalMatrix</span> <span class="o">=</span> <span class="nx">mat4</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
            <span class="c1">// 求modelViewMatrix的逆矩阵，结果存入normalMatrix
</span><span class="c1"></span>            <span class="nx">mat4</span><span class="p">.</span><span class="nx">invert</span><span class="p">(</span><span class="nx">normalMatrix</span><span class="p">,</span> <span class="nx">modelViewMatrix</span><span class="p">);</span>
            <span class="c1">// 求normalMatrix的转置矩阵，结果存入normalMatrix
</span><span class="c1"></span>            <span class="nx">mat4</span><span class="p">.</span><span class="nx">transpose</span><span class="p">(</span><span class="nx">normalMatrix</span><span class="p">,</span> <span class="nx">normalMatrix</span><span class="p">);</span>

            <span class="nx">gl</span><span class="p">.</span><span class="nx">uniformMatrix4fv</span><span class="p">(</span>
                <span class="nx">programInfo</span><span class="p">.</span><span class="nx">uniformLocations</span><span class="p">.</span><span class="nx">projectionMatrix</span><span class="p">,</span>
                <span class="kc">false</span><span class="p">,</span>
                <span class="nx">projectionMatrix</span><span class="p">);</span>
            <span class="nx">gl</span><span class="p">.</span><span class="nx">uniformMatrix4fv</span><span class="p">(</span>
                <span class="nx">programInfo</span><span class="p">.</span><span class="nx">uniformLocations</span><span class="p">.</span><span class="nx">modelViewMatrix</span><span class="p">,</span>
                <span class="kc">false</span><span class="p">,</span>
                <span class="nx">modelViewMatrix</span><span class="p">);</span>
            <span class="nx">gl</span><span class="p">.</span><span class="nx">uniformMatrix4fv</span><span class="p">(</span>
                <span class="nx">programInfo</span><span class="p">.</span><span class="nx">uniformLocations</span><span class="p">.</span><span class="nx">normalMatrix</span><span class="p">,</span>
                <span class="kc">false</span><span class="p">,</span>
                <span class="nx">normalMatrix</span><span class="p">);</span>

            <span class="c1">// Tell WebGL we want to affect texture unit 0
</span><span class="c1"></span>            <span class="c1">// GL最多可同时注册32张纹理；gl.TEXTURE0是第一张
</span><span class="c1"></span>            <span class="nx">gl</span><span class="p">.</span><span class="nx">activeTexture</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE0</span><span class="p">);</span>
            <span class="c1">// Bind the texture to texture unit 0
</span><span class="c1"></span>            <span class="nx">gl</span><span class="p">.</span><span class="nx">bindTexture</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="nx">texture</span><span class="p">);</span>
            <span class="c1">// Tell the shader we bound the texture to texture unit 0
</span><span class="c1"></span>            <span class="nx">gl</span><span class="p">.</span><span class="nx">uniform1i</span><span class="p">(</span><span class="nx">programInfo</span><span class="p">.</span><span class="nx">uniformLocations</span><span class="p">.</span><span class="nx">uSampler</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

            <span class="p">{</span>
                <span class="kr">const</span> <span class="nx">vertexCount</span> <span class="o">=</span> <span class="mi">36</span><span class="p">;</span>
                <span class="kr">const</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">UNSIGNED_SHORT</span><span class="p">;</span>
                <span class="kr">const</span> <span class="nx">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="nx">gl</span><span class="p">.</span><span class="nx">drawElements</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TRIANGLES</span><span class="p">,</span> <span class="nx">vertexCount</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">offset</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="9-使用动画纹理贴图了解">9 使用动画纹理贴图(了解)</h1>
<p>在本演示中，我们以上一个示例为基础，将静态纹理替换为正在播放的mp4视频文件的帧。实际上，这很容易做到，而且观看起来很有趣。</p>
<p>您可以使用类似的代码来使用任何类型的数据（例如<code>&lt;canvas&gt;</code>）作为纹理的源。</p>
<h2 id="获取视频">获取视频</h2>
<p>创建<code>&lt;video&gt;</code>元素并开始播放：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="c1">// will set to true when video can be copied to texture
</span><span class="c1"></span><span class="kd">var</span> <span class="nx">copyVideo</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">setupVideo</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">video</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;video&#39;</span><span class="p">);</span>

  <span class="kd">var</span> <span class="nx">playing</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">timeupdate</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

  <span class="nx">video</span><span class="p">.</span><span class="nx">autoplay</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="nx">video</span><span class="p">.</span><span class="nx">muted</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="nx">video</span><span class="p">.</span><span class="nx">loop</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

  <span class="c1">// Waiting for these 2 events ensures
</span><span class="c1"></span>  <span class="c1">// there is data in the video
</span><span class="c1"></span>  <span class="nx">video</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;playing&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
     <span class="nx">playing</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
     <span class="nx">checkReady</span><span class="p">();</span>
  <span class="p">},</span> <span class="kc">true</span><span class="p">);</span>
  <span class="nx">video</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;timeupdate&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
     <span class="nx">timeupdate</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
     <span class="nx">checkReady</span><span class="p">();</span>
  <span class="p">},</span> <span class="kc">true</span><span class="p">);</span>

  <span class="nx">video</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>
  <span class="nx">video</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span>

  <span class="kd">function</span> <span class="nx">checkReady</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">playing</span> <span class="o">&amp;&amp;</span> <span class="nx">timeupdate</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">copyVideo</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">video</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="用视频帧作为纹理">用视频帧作为纹理</h2>
<p>接下来的更改是<code>initTexture()</code>，它不再需要加载图像文件，它所做的只是创建一个空的纹理对象，在其中放置一个像素：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">initTexture</span><span class="p">(</span><span class="nx">gl</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">texture</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">createTexture</span><span class="p">();</span>
  <span class="nx">gl</span><span class="p">.</span><span class="nx">bindTexture</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="nx">texture</span><span class="p">);</span>
  <span class="c1">// Because video has to be download over the internet
</span><span class="c1"></span>  <span class="c1">// they might take a moment until it&#39;s ready so
</span><span class="c1"></span>  <span class="c1">// put a single pixel in the texture so we can
</span><span class="c1"></span>  <span class="c1">// use it immediately.
</span><span class="c1"></span>  <span class="kr">const</span> <span class="nx">level</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kr">const</span> <span class="nx">internalFormat</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">;</span>
  <span class="kr">const</span> <span class="nx">width</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kr">const</span> <span class="nx">height</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kr">const</span> <span class="nx">border</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kr">const</span> <span class="nx">srcFormat</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">;</span>
  <span class="kr">const</span> <span class="nx">srcType</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">UNSIGNED_BYTE</span><span class="p">;</span>
  <span class="kr">const</span> <span class="nx">pixel</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Uint8Array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">]);</span>  <span class="c1">// opaque blue
</span><span class="c1"></span>  <span class="nx">gl</span><span class="p">.</span><span class="nx">texImage2D</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="nx">level</span><span class="p">,</span> <span class="nx">internalFormat</span><span class="p">,</span>
                <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">,</span> <span class="nx">border</span><span class="p">,</span> <span class="nx">srcFormat</span><span class="p">,</span> <span class="nx">srcType</span><span class="p">,</span>
                <span class="nx">pixel</span><span class="p">);</span>

  <span class="c1">// Turn off mips and set wrapping to clamp to edge so it
</span><span class="c1"></span>  <span class="c1">// will work regardless of the dimensions of the video.
</span><span class="c1"></span>  <span class="nx">gl</span><span class="p">.</span><span class="nx">texParameteri</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_WRAP_S</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">CLAMP_TO_EDGE</span><span class="p">);</span>
  <span class="nx">gl</span><span class="p">.</span><span class="nx">texParameteri</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_WRAP_T</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">CLAMP_TO_EDGE</span><span class="p">);</span>
  <span class="nx">gl</span><span class="p">.</span><span class="nx">texParameteri</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_MIN_FILTER</span><span class="p">,</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">LINEAR</span><span class="p">);</span>

  <span class="k">return</span> <span class="nx">texture</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>当视频可用时，需要更新纹理：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">updateTexture</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">texture</span><span class="p">,</span> <span class="nx">video</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">gl</span><span class="p">.</span><span class="nx">bindTexture</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="nx">texture</span><span class="p">);</span>
  <span class="kr">const</span> <span class="nx">level</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kr">const</span> <span class="nx">internalFormat</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">;</span>
  <span class="kr">const</span> <span class="nx">srcFormat</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">RGBA</span><span class="p">;</span>
  <span class="kr">const</span> <span class="nx">srcType</span> <span class="o">=</span> <span class="nx">gl</span><span class="p">.</span><span class="nx">UNSIGNED_BYTE</span><span class="p">;</span>
  <span class="nx">gl</span><span class="p">.</span><span class="nx">texImage2D</span><span class="p">(</span><span class="nx">gl</span><span class="p">.</span><span class="nx">TEXTURE_2D</span><span class="p">,</span> <span class="nx">level</span><span class="p">,</span> <span class="nx">internalFormat</span><span class="p">,</span> <span class="nx">srcFormat</span><span class="p">,</span> <span class="nx">srcType</span><span class="p">,</span> <span class="nx">video</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>main函数中调用<code>initTexture</code>和<code>updateTexture</code>的代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">texture</span> <span class="o">=</span> <span class="nx">initTexture</span><span class="p">(</span><span class="nx">gl</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">video</span> <span class="o">=</span> <span class="nx">setupVideo</span><span class="p">(</span><span class="s1">&#39;Firefox.mp4&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">then</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="c1">// Draw the scene repeatedly
</span><span class="c1"></span><span class="kd">function</span> <span class="nx">render</span><span class="p">(</span><span class="nx">now</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">now</span> <span class="o">*=</span> <span class="mf">0.001</span><span class="p">;</span>  <span class="c1">// convert to seconds
</span><span class="c1"></span>  <span class="kr">const</span> <span class="nx">deltaTime</span> <span class="o">=</span> <span class="nx">now</span> <span class="o">-</span> <span class="nx">then</span><span class="p">;</span>
  <span class="nx">then</span> <span class="o">=</span> <span class="nx">now</span><span class="p">;</span>

  <span class="c1">// 视频可用时，更新纹理
</span><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="nx">copyVideo</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">updateTexture</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">texture</span><span class="p">,</span> <span class="nx">video</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">drawScene</span><span class="p">(</span><span class="nx">gl</span><span class="p">,</span> <span class="nx">programInfo</span><span class="p">,</span> <span class="nx">buffers</span><span class="p">,</span> <span class="nx">texture</span><span class="p">,</span> <span class="nx">deltaTime</span><span class="p">);</span>

  <span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">render</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">render</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="完整代码-2">完整代码</h2>
<p><a href="https://github.com/mdn/webgl-examples/tree/gh-pages/tutorial/sample8">https://github.com/mdn/webgl-examples/tree/gh-pages/tutorial/sample8</a></p>

    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/webgl/">WebGL</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/20220122webgl3/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">《WebGL编程指南》阅读笔记</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/20220122webgl1/">
            <span class="next-text nav-default">OpenGL基本概念</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:al4fun@163.com" class="iconfont icon-email" title="email"></a>
      <a href="http://github.com/al4fun" class="iconfont icon-github" title="github"></a>
  <a href="https://al4fun.gitee.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2016 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span>al4fun</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js"></script>








</body>
</html>
